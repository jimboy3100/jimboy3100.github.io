/***
Copyright (c) 2013-2016, callstats.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats.js  version = 3.21.0 2017-07-04 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){this.value=[],this.value.push(a),this.left=null,this.right=null}function e(a){this.root=null,this.top=null,this.bottom=null,this.comparator=a,this.node_counter=0,this.duplicate_counter=0}d.prototype={constructor:d,toString:function(){return this.value.toString()}},e.prototype={constructor:e},e.prototype.getTop=function(){return this.top},e.prototype.getTopValue=function(){return null===this.top?null:this.top.value[0]},e.prototype.getBottomValue=function(){return null===this.bottom?null:this.bottom.value[0]},e.prototype.getBottom=function(){return this.bottom},e.prototype.getDuplicatedCounter=function(){return this.duplicate_counter},e.prototype.getNodeCounter=function(){return this.node_counter},e.prototype.getSize=function(){return this.duplicate_counter+this.node_counter},e.prototype.logTree=function(){function a(b,c,d){if(null!==b){for(var e="-",f=0;f<c;++f)e+="--";null!==b.left&&a(b.left,c+1,"Left"),null!==b.right&&a(b.right,c+1,"Right")}}return null===this.root?void console.log("This tree is empty"):void a(this.root,0,"Root")},e.prototype.insertByTop=function(a){this.inserting(a,this.top)},e.prototype.insertByBottom=function(a){this.inserting(a,this.bottom)},e.prototype.insert=function(a){this.inserting(a,this.root)},e.prototype.inserting=function(a,b){var c=function(){var b=new d(a);return(null===this.top||this.comparator(this.top.value[0],b.value[0])<0)&&(this.top=b),(null===this.bottom||this.comparator(b.value[0],this.bottom.value[0])<0)&&(this.bottom=b),b};if(null===this.root)return this.root=c.call(this),void(this.node_counter=1);for(var e=null,f=b,g=0,h=function(b){return b===a};null!==f;){if(g=this.comparator(a,f.value[0]),0===g)return void(f.value.find(h)||(f.value.push(a),++this.duplicate_counter));e=f,f=g<0?f.left:f.right}++this.node_counter,g<0?e.left=c.call(this):e.right=c.call(this)},e.prototype.search=function(a){for(var b,c=this.root,d=null,e=function(b){return b===a};null!==c;){if(b=this.comparator(a,c.value[0]),0===b)return c.value.find(e)?(c.parent=d,c):null;d=c,c=b<0?c.left:c.right}return null},e.prototype.getRightist=function(a){for(var b=null;null!==a.right;)b=a,a=a.right;return a.parent=b,a},e.prototype.getLeftist=function(a){for(var b=null;null!==a.left;)b=a,a=a.left;return a.parent=b,a},e.prototype.deleteBottomValue=function(){for(;null===this.bottom;)return null;var a=this.bottom.value[0];return this.delete(a),a},e.prototype.deleteTopValue=function(){for(;null===this.top;)return null;var a=this.top.value[0];return this.delete(a),a},e.prototype.delete=function(a){var b=null,c=function(a,b,c){null!==b?b.left===a?b.left=c:b.right=c:this.root=c},d=function(a){return null===this.root?void(this.bottom=this.top=null):(0===this.comparator(this.top.value[0],a.value[0])&&(this.top=this.getRightist(this.root)),void(0===this.comparator(this.bottom.value[0],a.value[0])&&(this.bottom=this.getLeftist(this.root))))};if(b=this.search(a),null===b)return!1;if(1<b.value.length)return b.value.splice(b.value.indexOf(a),1),--this.duplicate_counter,!0;if(--this.node_counter,null===b.left&&null===b.right)c.call(this,b,b.parent,null);else if(null===b.left)c.call(this,b,b.parent,b.right);else if(null===b.right)c.call(this,b,b.parent,b.left);else{for(var e=b.left,f=b;null!==e.right;f=e,e=e.right);f===b?f.left=e.left:f.right=e.left,b.value.shift(),b.value=b.value.concat(e.value)}return d.call(this,b),!0},b.exports=e},{}],2:[function(a,b,c){(function(c){"use strict";!function(){function d(){function b(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function c(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function d(){var a=c();return a+Ma.currentOffset}function e(){return window.performance.now?window.performance.now():null}function f(){navigator&&"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){Ja=a})}function g(){if(Ja)return Ja.level}function h(){if(Ja)return Ja.charging}function i(a,b){return a.sort().toString()===b.sort().toString()}function j(a){navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(b){ga?i(ga,b)||(ga=b,Eb(a)):(ga=b,Eb(a)),setTimeout(function(){j(a)},oa)}).catch(function(){setTimeout(function(){j(a)},oa)})}function k(){na||window&&window.addEventListener&&window.addEventListener("beforeunload",function(a){var b;for(b in La)La.hasOwnProperty(b)&&Bb(Ua.userLeft,null,b,La[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function l(a,b,c,d,f){var g=Rb(c,d),h=null;g&&(h=e(),Bb(Ua.mediaPlaybackStartEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function m(a,b,c,d,f){var g=Rb(c,d),h=null;g&&(h=e(),Bb(Ua.mediaSuspendedEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function n(a,b,c,d,e){var f,g=document.getElementById(c);g&&(g.oncanplay=function(){f=La[b].ucID,l(f,a,b,d,e)},g.onsuspend=function(){f=La[b].ucID,m(f,a,b,d,e)})}function o(a){var b=ia.codebase,c=!1;if(null===a)c=!1;else if(b===kb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==Sa&&a instanceof Sa&&(c=!0),"function"!=typeof a&&b!==kb.edge||(c=!0),void 0!==typeof a.createOffer&&(c=!0);return c}function p(a,b){var c;return a&&(b===kb.chrome?a.googLocalAddress?(c=a.googLocalAddress,c.concat(":",a.googRemoteAddress)):a.selectedCandidatePairId&&(c=a.selectedCandidatePairId):b===kb.firefox&&(c=a.localAddr,c.concat(":",a.remoteAddr))),Ib(c)}function q(){var a;return a=navigator.onLine===!0?"online":"offline"}function r(a,b,c){var d=null;c.ssrcMap.hasOwnProperty(a.data.ssrc)&&(c.ssrcMap[a.data.ssrc].mediaType=a.data.mediaType,a.data.googCodecName?d=a.data.googCodecName:a.data.codec&&(d=a.data.codec),c.ssrcMap[a.data.ssrc].codec=d,a.data.codecImplementationName&&(c.ssrcMap[a.data.ssrc].codecImplementationName=a.data.codecImplementationName))}function s(a,b,c){var d,e,f,g,h,i,j,k,l=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k=c-g,k>0&&(b[d].csioReceivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/k,b[d].csioSentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/k,b[d].csioIntBytesReceived=parseInt(b[d].bytesReceived,10)-i,b[d].csioIntBytesSent=parseInt(b[d].bytesSent,10)-j,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(b[d].csioSentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(k/1e3),b[d].csioIntPacketsSent=parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(b[d].csioReceivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(k/1e3),b[d].csioIntPacketsReceived=parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))),l.push(b[d]))}return l}function t(a,b,c,d){var e=[];return c===kb.firefox?e=null:b&&(e=s(a,b,d)),e}function u(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===bb.bad?a.streams[b].inbound[d].mark=2:c===bb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===bb.bad?a.streams[b].outbound[d].mark=2:c===bb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function v(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function w(a){var b={},c=Mc.getConferenceURL();return a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),c&&(b.conferenceURL=c),b.streams={},null===a.streams?b:(a.streams.forEach(function(a){var c={cname:a.cname,ssrc:a.ssrc,msid:a.msid,remoteUserID:a.userID,usageLabel:a.usage,associatedVideoTag:a.associatedVideoTag};a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel),a.data.hasOwnProperty("audioLevel")&&(c.audioLevel=a.data.audioLevel),a.data.hasOwnProperty("csioAvgRtt")&&(c.averageRTT=a.data.csioAvgRtt),a.data.hasOwnProperty("csioAvgJitter")&&(c.averageJitter=a.data.csioAvgJitter),a.data.hasOwnProperty("csioPktLossPercentage")&&(c.packetLossPercentage=a.data.csioPktLossPercentage),a.reportType&&"local"===a.reportType?a.streamType&&(c.statsType=a.streamType+"-rtp"):a.reportType&&"remote"===a.reportType&&a.streamType&&(c.statsType="remote-"+a.streamType+"-rtp"),b.streams[a.ssrc]=c}),b)}function x(a,b,c,e,f,g){var h=d();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&!Na?(R(Va.processedStats,a,g),b.latestEventSent=h,b.lastFabricState=b.pcState):(a.clockUnsynced=Na,Ba.cacheEvent({channel:Va.processedStats,data:a}),a.hasOwnProperty("token")||Ga.sendAuthenticationRequest(ja,f))}function y(a,b){for(var c in b)b.hasOwnProperty(c)&&"id"!==c&&"type"!==c&&(a[c]=b[c]);return a}function z(a,b,e,f,i,j,k){function l(l){if(l){var m=d(),n=c();void 0===j.lastRawStatsSentInterval||null===j.lastRawStatsSentInterval?j.lastRawStatsSentInterval=n-j.statsPollingStart:j.lastRawStatsSentInterval=n-j.rawstatsTS+j.lastRawStatsSentInterval,void 0===j.lastProcessedStatsSentInterval||null===j.lastProcessedStatsSentInterval?j.lastProcessedStatsSentInterval=ta+1:j.lastProcessedStatsSentInterval=n-j.rawstatsTS+j.lastProcessedStatsSentInterval,j.rawstatsTS=n;var o={},s=ia.codebase;o.version=aa,o.appID=ja,o.conferenceID=encodeURIComponent(f),o.apiTS=m,o.timeShift=0,o.fabricState=j.pcState,o.pcID=j.pcHash,void 0!==i&&(o.ucID=i),Ga.authToken?o.token=Ga.authToken:Ga.sendAuthenticationRequest(ja,b),o.localID=encodeURIComponent(b),o.remoteID=encodeURIComponent(e),o.deviceID=ma;var y,z,A,C,G,H,J,K={streams:[]},L=null,M=!1,N=!1,O={},P={};for(L=Ub(l),y=0;y<L.length;++y)if(z=E(L[y]),A=B(z),!F(A))if(A.hasOwnProperty("Transport"))C="Transport",K.hasOwnProperty(C)||(K[C]=[]),s!==kb.firefox?(parseInt(A[C].bytesReceived,10)>0||parseInt(A[C].bytesSent,10)>0)&&(K[C].push(A[C]),"true"!==A[C].googActiveConnection&&A[C].googActiveConnection!==!0||(o.activeConnectionIndex=K[C].length)):(K[C].push(A[C]),"true"!==A[C].selected&&A[C].selected!==!0||(o.activeConnectionIndex=K[C].length));else if(A.localCandidate)O[A.localCandidate.id]=A.localCandidate;else if(A.remoteCandidate)P[A.remoteCandidate.id]=A.remoteCandidate;else if(A.bwe)K.bwe=A.bwe;else if(A.trackStats)K.trackStats||(K.trackStats=[]),K.trackStats.push(A.trackStats);else if(A.codec)K.codec||(K.codec=[]),K.codec.push(A.codec);else if(A.candidatePair)K.candidatePair||(K.candidatePair=[]),K.candidatePair.push(A.candidatePair);else{H=yb(j,A.ssrc),void 0!==H&&H.localStartTime||(J=Ab(e,f,i,j,k,null),J&&(N=!0),H=yb(j,A.ssrc)),H&&(G=H.remoteUserID),void 0===G&&(G=e);var Q={userID:G,data:A.data,reportType:A.reportType,streamType:A.streamType,ssrc:A.ssrc};void 0!==H&&(Q.cname=H.cname,Q.msid=H.msid,Q.associatedVideoTag=H.associatedVideoTag,Q.usage=H.usageLabel),K.streams.push(Q)}if(K.Transport){s===kb.firefox&&(K.Transport=v(K.Transport,O,P));for(var R=0;R<K.Transport.length;R++)K.Transport[R].hash=p(K.Transport[R],s)}o.statistics=K,K.Transport&&(M=D(K.Transport,j)),M&&Ac(k,Ua.fabricTransportSwitch,f),j.pcState===cb.disrupted&&I(o),K.trackStats&&(K=Fc(K)),K.Transport&&K.candidatePair&&(K=Ec(K)),N&&Bb(Ua.ssrcMap,e,f,i,zb(j),j.pcHash);var S={},U={response:null};if(fa.fire(fa.events.OnPolling,{streams:K.streams,codeBase:s}),fa.fire(fa.events.OnStatsRequest,U),null!==U.response){if(U.response.streams)for(y=0;y<U.response.streams.length;y++)r(U.response.streams[y],s,j);if(S.streams=U.response.streams,S.fabricState=j.pcState,S.connectionState=q(),K.Transport&&(S.Transport=t(j,K.Transport,s,m)),K.bwe&&(S.bwe=K.bwe),void 0===j.processedStatsTupleArray&&(j.processedStatsTupleArray=[]),ra.stats){var V=w(S);ra.stats(V)}S.apiTS=m,S.batteryStatus={},S.batteryStatus.batteryLevel=g(),S.batteryStatus.isBatteryCharging=h(),S=u(S),j.processedStatsTupleArray.push(S),o.processedStatistics=j.processedStatsTupleArray,j.lastStatsSent=o;var W=T(o),X=T(o);delete W.processedStatistics,delete X.statistics,j.lastProcessedStatsSentInterval>=ta&&(j.processedStatsTupleArray=[],Ea.add(X,X.processedStatistics.length),X.msgStat=Ea.getStat(),x(X,j,f,e,b,a),j.lastProcessedStatsSentInterval=0)}}}return l}function A(a){var b;return db.hasOwnProperty(a)?a===db.createOffer||a===db.createAnswer||a===db.setRemoteDescription?b=eb.negotiationFailure:a===db.setLocalDescription?b=eb.sdpError:a===db.addIceCandidate?b=eb.sdpError:a===db.getUserMedia?b=eb.mediaConfigError:a===db.iceConnectionFailure?b=eb.iceFailure:a===db.signalingError?b=eb.signalingError:(a===db.applicationLog||db.applicationError)&&(b=eb.applicationLog):b=ub.invalidWebRTCFunctionName,b}function B(a){var b={};if("inboundrtp"===a.type||"outboundrtp"===a.type||"inbound-rtp"===a.type||"outbound-rtp"===a.type){if(b.ssrc=a.ssrc,b.streamType="inboundrtp"===a.type||"inbound-rtp"===a.type?"inbound":"outbound","Safari"===ia.name&&!a.mediaType){a.id.includes("Audio")?a.mediaType="audio":a.id.includes("Video")&&(a.mediaType="video");var c=a.id.split("_");if(c[1])try{a.ssrc=parseInt(c[1]),b.ssrc=a.ssrc}catch(a){}}b.data=a,void 0!==a.isRemote?b.reportType="true"===a.isRemote||a.isRemote===!0?"remote":"local":b.reportType="local",a.trackId&&(b.trackId=a.trackId),a.mediaType&&(b.mediaType=a.mediaType)}else"candidatepair"===a.type&&a.selected?b.Transport=a:"localcandidate"===a.type||"local-candidate"===a.type?b.localCandidate=a:"remotecandidate"===a.type||"remote-candidate"===a.type?b.remoteCandidate=a:"transport"===a.type||"googCandidatePair"===a.type?b.Transport=a:"VideoBwe"===a.type?b.bwe=a:"track"===a.type?b.trackStats=a:"candidate-pair"===a.type?b.candidatePair=a:"codec"===a.type?b.codec=a:"ssrc"===a.type&&(b.reportType="local",a.bytesSent?b.streamType="outbound":b.streamType="inbound",b.ssrc=a.ssrc,b.data=a);return b}function C(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function D(a,b){var c,d,e,f,g,h,i,j,k,l=!1,m="None",n=!1,o=function(a){if(a.typePreference){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c&&(b>=0&&b<=2&&(m=C(b)),!0)}return!1};for(i=0;i<a.length;i++)if(j=a[i],!navigator.mozGetUserMedia||"candidatepair"!==j.type||"true"!==j.selected&&j.selected!==!0?"googCandidatePair"!==j.type||"true"!==j.googActiveConnection&&j.googActiveConnection!==!0?"transport"===j.type&&(n=!0,j.selectedCandidatePairId&&(k=j.selectedCandidatePairId)):(n=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType):(n=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType),n){c&&(h=0===c.indexOf("[")),b.iceCandidates.some(o);break}if(!n)return l;var p=b.transportData;return void 0!==p&&p.localAddr===c&&p.remoteAddr===d&&p.transportType===g&&p.selectedCandidatePairId===k||(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:m,selectedCandidatePairId:k},l=!0),l}function E(a){var b,c={};a.timestamp instanceof Date&&(c.timestamp=a.timestamp.getTime().toString()),a.type&&(c.type=a.type);var d=0;if(a.names){var e=a.names();for(d=0;d<e.length;++d)c[e[d]]=a.stat(e[d])}else for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);if(c.values){for(d=0;d<c.values.length;++d){a=c.values[d];for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b])}delete c.values}return c}function F(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function G(a){return{magicKey:a,statsSubmissionInterval:ta,endpoint:Ka,localUserIDObject:la}}function H(a,b,c){var d=La[a];void 0===d&&(La[a]={},La[a].participants=null,c&&(La[a].userJoinedSent=!0),b&&(La[a].refreshPresence=b))}function I(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function J(a){return clearInterval(a),null}function K(){var a;for(a in La)La.hasOwnProperty(a)&&(La[a].refreshPresence=J(La[a].refreshPresence),delete La[a].refreshPresence);V()}function L(a){var b=La[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function M(a,b){var c=La[a],d=[];if(void 0===c)d.push(b),La[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function N(a){var b=!1;if(!La[a])return{conferenceFinished:b,ucID:null};var c=La[a].ucID;return 0===La[a].participants.length&&(J(La[a].refreshPresence),V(),Ba.sendCachedEvents(Ga),delete La[a],b=!0),{conferenceFinished:b,ucID:c}}function O(a,b){Bb(Ua.userLeft,null,a,b,null,null,null),V(),Oa=wb,wb=null}function P(){var a,b=function(a){return setInterval(function(){Fb(a)},va)};for(a in La)La.hasOwnProperty(a)&&(Fb(a),La[a].refreshPresence=b(a));W()}function Q(a){try{if(window&&window.sessionStorage){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));if(b&&b[a])return b[a].ucID}}catch(a){return null}return null}function R(a,b,c){var d=b.action;b.channel=a,Ga._isTokenValid(Ga.authToken,ja,ka)?Na&&mb.indexOf(d)===-1?(b.clockUnsynced=Na,Ba.cacheEvent({channel:a,data:b,callback:c})):(b.token=Ga.authToken,Nc(a,b,c),c&&d&&c(Xa.success,d+" sent to the backend.")):Ga.sendAuthenticationRequest(ja,ka,function(e,f){e!==Xa.success?(e===Ya.authOngoing&&(b.clockUnsynced=Na,Ba.cacheEvent({channel:a,data:b,callback:c})),c&&e!==Ya.authOngoing&&c(e,f)):e===Xa.success&&"SDK authentication successful."===f&&(Na&&mb.indexOf(d)===-1?(b.clockUnsynced=Na,Ba.cacheEvent({channel:a,data:b,callback:c})):(b.token=Ga.authToken,Nc(a,b,c),c&&d&&c(Xa.success,d+" sent to the backend.")))})}function S(a){a&&a(Ya.authOngoing,null)}function T(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=T(a[b]));return c}function U(){var a={};Object.keys(La).forEach(function(b){var c=La[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:!!Ga.tokenData,clockSync:!Na,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:aa};b.wsStatus=Mc.getWSConnectionState(),tb(ja,ka,"stateMachine",b)}function V(){Pa||(Pa=setInterval(function(){U()},Qa))}function W(){J(Pa),Pa=null}var X=a("./callstatsUtils"),Y=a("./statsReporter"),Z=a("./pcCallbackHandler"),$="https://collector.callstats.io:443/",_="https://auth.callstats.io/",aa="3.21.0",ba="wss://collector.callstats.io:443/csiows/collectCallStats",ca="https://dashboard.callstats.io/apps/",da="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",ea="https://appsettings.callstats.io/v1/apps/",fa=new Y.Reporter;window&&(window.csioChromeLegacyGetStats=!0);var ga,ha,ia,ja=null,ka=null,la=null,ma=null,na=!1,oa=1e4,pa=1e3,qa={create:Date.now()},ra={stats:null,configService:null},sa=2e4,ta=15e3,ua=!1,va=1e4,wa=5e3,xa=2e3,ya=!1,za=!0,Aa=function(){function a(a,b){setTimeout(function(){var b=d(),c=b-a.data.apiTS;a.data.timeShift=c,R(a.channel,a.data,a.callback)},b)}this.eventCache=[],this.sendCachedEvents=function(b,c,e,f,g,h){var i=this;if(!b.authToken)return void b.sendAuthenticationRequest(ja,ka);if(!c){var j,k,l,m,n=d(),o=[],p=Math.max(ta/i.eventCache.length,Ra);for(j=0;j<i.eventCache.length;j++)if(l=i.eventCache[j],l.data.action!==Ua.userJoined){if(l.data.token=b.authToken,e&&l.data.apiTS>=n-f||!l.data.ucID)if(m=decodeURIComponent(l.data.conferenceID),La[m]&&La[m].ucID)l.data.ucID=La[m].ucID;else{if(m!==g){o.push(i.eventCache[j]);continue}l.data.ucID=h}if(l.data.clockUnsynced&&(l.data.apiTS+=Ma.currentOffset),l.channel===Va.processedStats&&l.data.clockUnsynced&&l.data.processedStatistics&&l.data.processedStatistics.length>0)for(k=0;k<l.data.processedStatistics.length;k++)l.data.processedStatistics[k].apiTS+=Ma.currentOffset;delete l.data.clockUnsynced,a(l,p*(j+1))}else o.push(i.eventCache[j]);i.eventCache=o}},this.sendCachedUserJoinedEvents=function(b){var c=this;if(!b.authToken)return void b.sendAuthenticationRequest(ja,ka);var d,e,f=[],g=Math.max(ta/c.eventCache.length,Ra);for(d=0;d<c.eventCache.length;d++)e=c.eventCache[d],e.data.action===Ua.userJoined||e.data.action===Ta.fabricSetupFailed?(e.data.token=b.authToken,e.data.clockUnsynced&&(e.data.apiTS=e.data.apiTS+Ma.currentOffset),e.data.value&&(e.data.value.statsSubmissionInterval=ta),a(e,g*(d+1))):f.push(c.eventCache[d]);c.eventCache=f},this.cacheEvent=function(a){this.eventCache.push(a)},this.sendCachedFeedback=function(){var a=ob("feedback"),b=JSON.parse(ob("csio_auth_data"));if(a&&b){var c=JSON.parse(a),d=b===c.token;d||ka!==c.userID||(c.token=b,d=!0),d?R(Va.userFeedback,c):pb("feedback")}}},Ba=new Aa,Ca=function(){this.size_max=0,this.size_ewma=0,this.statNum_max=0,this.statNum_ewma=0,this.msg_num=0},Da=function(){this.stat=new Ca,this.add=function(a,b){var c=this.memorySizeOf(a);this.stat.size_ewma=.5*this.stat.size_ewma+.5*c,this.stat.size_max<c&&(this.stat.size_max=c),this.stat.statNum_ewma=.5*this.stat.statNum_ewma+.5*b,this.stat.statNum_max<b&&(this.stat.statNum_max=b),this.stat.msg_num+=1},this.getStat=function(){return this.stat},this.memorySizeOf=function(a){function b(a){if(null!==a&&void 0!==a)switch(typeof a){case"number":c+=8;break;case"string":c+=2*a.length;break;case"boolean":c+=4;break;case"object":var d=Object.prototype.toString.call(a).slice(8,-1);if("Object"===d||"Array"===d)for(var e in a)a.hasOwnProperty(e)&&b(a[e]);else c+=2*a.toString().length}return c}var c=0;return b(a)}},Ea=new Da,Fa=function(){var a=this,b="urn:x-callstats:auth:errorActions",c=.9,e=3600;this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(a,b){b("Token generator not set")};var f=null,g=null,h=!1,i=window.atob,j=window.btoa,k=function(a){return j(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(a){for(var b=i(a.replace(/[ \r\n]+$/,"")),c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d).toString(16);1===e.length&&(e="0"+e),c.push(e)}return c.join("")},m={};m.cryptotype=null,window.crypto&&window.crypto.subtle?(m.cryptotype="standard",m.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(m.cryptotype="webkit",m.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(m.cryptotype="ie",m.subtlecrypto=window.msCrypto.subtle):(m.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),m.sign=function(a,b,c,d){if("HS256"!==a.alg)return d("Use header.alg=HS256");a=JSON.stringify(a),"string"!=typeof b&&(b=JSON.stringify(b));var e=k(a)+"."+k(b);if(window.csioReactNative)return void window.csiosign(e,c,function(a,b){return a?(console.log("Token sign error",a),d(a)):d(null,b)});for(var f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=e.length-1;h>=0;h--)g[h]=e.charCodeAt(h);var i=function(a){for(var b="",c=new Uint8Array(a),f=c.byteLength,g=0;g<f;g++)b+=String.fromCharCode(c[g]);return e+="."+k(b),d(null,e)},j=function(a){return d(a)},l={name:"HMAC"};"ie"!==m.cryptotype&&"webkit"!==m.cryptotype||(l.hash={name:"sha-256"});var n=m.subtlecrypto.sign(l,c,g);"ie"===m.cryptotype?(n.onerror=j,n.oncomplete=function(a){i(a.target.result)}):n.then(i).catch(j)},m.decode=function(a){try{return JSON.parse(i(a.split(".")[1]))}catch(a){return console.error("Couldn't decode token. ",a),null}},m.importKey=function(a,b,c){if(window.csioReactNative)return void b(a);if("webkit"===m.cryptotype)for(;a.length<32;)a+="\0";var d={kty:"oct",k:k(a),alg:"HS256"},e={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===m.cryptotype?d.extractable=!1:d.ext=!1,"webkit"===m.cryptotype&&(e=null,d.use="sig"),"ie"===m.cryptotype||"webkit"===m.cryptotype){var f=JSON.stringify(d);d=new Uint8Array(f.length);for(var g=0;g<f.length;g++)d[g]=f.charCodeAt(g)}var h=m.subtlecrypto.importKey("jwk",d,e,!1,["sign"]);"ie"===m.cryptotype?(h.onerror=c,h.oncomplete=function(a){b(a.target.result)}):h.then(b).catch(c)},this._isTokenValid=function(a,b,c){var e=!1;if(null===a)return!1;try{var f=m.decode(a);if(null!==f&&f.appID===b&&f.userID===encodeURIComponent(c)){var g=null;if(navigator.mozGetUserMedia){var h=f.expiry.split(" ").join("T");g=Date.parse(h)}else g=new Date(f.expiry);var i=new Date(d());i<g&&(e=!0)}return e}catch(a){}return!1},this.setupAuthToken=function(a){nb("csio_auth_data",JSON.stringify(a)),this.authToken=a,this.tokenData=m.decode(a),ta=parseInt(this.tokenData.submissionInterval,10),fa.setSubmissionInterval(ta),fa.setReportingMode(this.tokenData.adaptiveInterval),ua=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(d,e,g){if(d&&e){if(a.authInProgress)return void S(g);null!==f&&(clearTimeout(f),f=null),n(),a.authInProgress=!0,a.tokenGenerator(h,function(i,j){if(null!==i)return a.authInProgress=!1,void(g&&g(Xa.tokenGenerationError,i.toString()));var k=_+"authenticate",l={client_id:e+"@"+ja,code:j,grant_type:"authorization_code"};Hc(k,l,function(i,j){var k=null;a.authInProgress=!1,qa.auth=j;try{k=JSON.parse(i.response)}catch(a){console.error("Authentication response parse error")}if(!k)return void(f=setTimeout(a.sendAuthenticationRequest,wa,d,e,g));if(200===i.status){if("bearer"!==k.token_type)return console.error("Authentication was successful, but token type was not bearer. Scheduling retry."),void(f=setTimeout(a.sendAuthenticationRequest,wa,d,e,g));a.setupAuthToken(k.access_token);var l=parseInt(1e3*parseInt(k.expires_in)*c);o(l,d,e,g),h=!1,g&&g(Xa.success,"SDK authentication successful."),Mb(),Mc._isChannelReady()?(Ba.sendCachedUserJoinedEvents(Ga),g&&g(Xa.success,"WebSocket establishment successful.")):Mc._setupWebSocketConnection(function(a,b){g&&g(a,b)})}else{if(k[b]&&k[b].length>0)return p(d,e,g,k[b]);console.error("Authentication failed, but no error actions were defined in response."),f=setTimeout(a.sendAuthenticationRequest,wa,d,e,g)}})})}};var n=function(){null!==g&&(clearTimeout(g),g=null)},o=function(b,c,d,e){n(),g=setTimeout(function(){a.sendAuthenticationRequest(c,d,e)},b)},p=function(a,b,c,d){if(0!==d.length){var e=d.shift();return e.action===vb.RETRY?(o(e.params.timeout,a,b,c),p(a,b,c,d)):e.action===vb.GET_NEW_TOKEN?(h=!0,p(a,b,c,d)):e.action===vb.REPORT_ERROR?p(a,b,c,d):void 0}};this.appSecretTokenGenerator=function(b){var c=null,f=null,g=!1,h=null;b.indexOf(":")>-1&&(h=l(b.split(":")[0]),b=b.split(":")[1]);var i=function(a){b=null,c=a},j=function(a){g=!0,b=null,console.error("Couldn't import key",a)};return m.importKey(b,i,j),function(b,i){if(g)return i("appsecret based token generation failed");if(!b&&null!==f)return i(null,f);if(null===c)return setTimeout(function(){a.tokenGenerator(b,i)},100);var j={userID:ka,appID:ja,exp:parseInt(d()/1e3)+e,nbf:parseInt(d()/1e3)-e};h&&(j.keyID=h),m.sign({alg:"HS256"},j,c,function(a,b){return a?i(a):(f=b,i(null,b))})}}},Ga=new Fa,Ha=new X;try{ia=Ha.detectBrowserInfo()}catch(a){console.log("detectBrowserInfo: Error",a)}var Ia;window.csioReactNative||(Ia=Ha.measureAppLoadingPerformance(ia),qa.loading=Ia);var Ja,Ka={type:"browser",name:ia.name,ver:ia.ver,os:ia.os,osVersion:ia.osVersion,userAgent:ia.userAgent},La={},Ma={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Na=!0,Oa=null,Pa=null,Qa=2e4,Ra=100,Sa=null;"Firefox"===ia.name?Sa=mozRTCPeerConnection:"Chrome"===ia.name||"Opera"===ia.name?Sa=webkitRTCPeerConnection:"Safari"===ia.name||"Edge"===ia.name&&(Sa=window.RTCPeerConnection);var Ta={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},Ua={autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",refreshPresence:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDevices:"connectedDevices"},Va={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},Wa={success:"success",failure:"failure"},Xa={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},Ya={authOngoing:"authOngoing"},Za={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},$a={local:"local",remote:"remote"},_a={excellent:5,good:4,fair:3,poor:2,bad:1},ab={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},bb={excellent:"excellent",fair:"fair",bad:"bad"},cb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",checkingDisrupted:"checkingDisrupted"},db={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},eb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",
applicationLog:"ApplicationLog"},fb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},gb={video:{gThreshold:.8,rThreshold:.3}},hb={video:{gThreshold:400,rThreshold:1e3}},ib={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},jb={audio:{gThreshold:240,rThreshold:400}},kb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},lb={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},mb=[Ua.userJoined,Ua.refreshPresence,Ta.fabricSetupFailed,Ta.applicationErrorLog],nb=function(a,b){try{window&&window.localStorage&&window.localStorage.setItem(a,b)}catch(a){return}},ob=function(a){try{if(window&&window.localStorage)return window.localStorage.getItem(a)}catch(a){return null}return null},pb=function(a){try{window&&window.localStorage&&window.localStorage.removeItem(a)}catch(a){return}},qb=function(){if(ma=ob("endpointID"),null===ma){var a=c(),b=Math.random()*a;fc(b.toString(),function(a){ma=a,nb("endpointID",ma)})}},rb=function(a,b,d,e,f){var g=null,h=null,i=null,j=new XMLHttpRequest;if(j.timeout=d,j){j.open("GET",encodeURI(a));for(var k in b)j.setRequestHeader(k,b[k]);g=c(),j.onload=function(){h=c(),i=h-g,e(j,i)},j.ontimeout=f,j.send()}},sb=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},tb=function(a,b,c,d){if(ya&&a){var e=$+"generics",f={appID:a,userID:encodeURIComponent(b),version:aa,eventType:c,data:d},g=JSON.stringify(f);ha!==g&&(ha=g,sb(e,g,function(a){200===a.status||200!==a.status}))}};window&&window.addEventListener&&window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:aa,eventType:"error",message:a.message,pageURL:window.location.href};for(b in La)La.hasOwnProperty(b)&&(d.conferenceID=b,tb(ja,ka,"onErrorLog",d),c=!0);c||tb(ja,ka,"onErrorLog",d)}});var ub={invalidWebRTCFunctionName:"Invalid WebRTC function name"},vb={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},wb=b(),xb=function(a,b,e){var f=RegExp.prototype.test.bind(/^([a-z])=(.*)/),g=/^ssrc:(\d*) ([\w_]*):(.*)/,h=/^ssrc-group:SIM (\d*)/;b.split(/(\r\n|\r|\n)/).filter(f).forEach(function(b){var f=b[0],i=b.slice(2);if("a"===f){if(g.test(i)){var j=i.match(g),k=j[1];void 0===a.ssrcMap[k]&&(a.ssrcMap[k]={}),a.ssrcMap[k][j[2]]=j[3],a.ssrcMap[k].localStartTime=c(),a.ssrcMap[k].syncedStartTime=d(),a.ssrcMap[k].streamType=e}h.test(i)&&(void 0===a.ssrcMap.ssrcGroup&&(a.ssrcMap.ssrcGroup={},a.ssrcMap.ssrcGroup[e]={}),a.ssrcMap.ssrcGroup[e].simulcastGroup=i.match(/\d+/g))}})},yb=function(a,b){return a.ssrcMap[b]},zb=function(a){return a.ssrcMap},Ab=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(xb(d,g,ab.outbound),xb(d,h,ab.inbound),ua){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Cb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Bb=function(a,b,c,e,f,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=d(),j={version:aa,apiTS:i,action:a,localID:encodeURIComponent(ka),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:ja,ucID:e,pcID:g,deviceID:ma,value:f};return null===b&&(j.remoteID=null),null===c?void tb(ja,ka,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(e&&!Na||a===Ua.userJoined||a===Ta.fabricSetupFailed||a===Ua.refreshPresence?(j.token=Ga.authToken,R(Va.callStatsEvent,j,h)):(j.clockUnsynced=Na,a!==Ua.fabricStatsCaching&&a!==Ua.refreshPresence&&Ba.cacheEvent({channel:Va.callStatsEvent,data:j,callback:h})))},Cb=function(a,b,c,e,f,g){var h=d(),i={version:aa,appID:ja,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(ka),remoteID:encodeURIComponent(a),pcID:f,deviceID:ma,sdpPayload:e};Ga.authToken&&c&&!Na?(i.token=Ga.authToken,R(Va.sdpSubmission,i,g)):(i.clockUnsynced=Na,Ba.cacheEvent({channel:Va.sdpSubmission,data:i,callback:g}),Ga.authToken||Ga.sendAuthenticationRequest(ja,ka))},Db=function(a,b,c,d,e,f,g){Zb(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=lc(b.iceCandidatePairs),g.currPair=b.activeIceCandidatePair,Bb(Ua.fabricStateChange,e,c,d,g,f)})},Eb=function(a){var b={connectedDevices:ga},c=La[a]?La[a].ucID:null;Bb(Ua.connectedDevices,null,a,c,b,null)},Fb=function(a){var b={ucID:La[a].ucID,endpoint:Ka,magicKey:wb};Bb(Ua.refreshPresence,null,a,La[a].ucID,b,null)},Gb=function(){var a={appID:ja,userID:encodeURIComponent(ka),version:aa,endpoint:Ka,pagePerf:Ia,endpointID:ma,action:"registerPresence",channel:Va.registerPresence};ja!==-1&&Ga.authToken&&(a.token=Ga.authToken,Nc(Va.registerPresence,a))},Hb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},Ib=function(a,b){var c,d,e,f=0;if(!a)return f;for(c=0,e=a.length;c<e;c++)d=a.charCodeAt(c),f=(f<<5)-f+d,f|=0;return b&&b(f),f},Jb=function(a,b,d,e,f,g){if(!a||!d||!b)return console.error("initialize: Argument missing/invalid"),Hb(Wa.failure,"initialize: Argument missing/invalid");if(e&&"function"!=typeof e)return console.error("initialize: Argument missing/invalid"),Hb(Wa.failure,"initialize: Argument missing/invalid");if(f&&"function"!=typeof f)return console.error("initialize: Argument missing/invalid"),Hb(Wa.failure,"initialize: Argument missing/invalid");if("function"!=typeof b){if(!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative))return console.error("Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),e&&e(Xa.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Hb(Wa.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");b=Ga.appSecretTokenGenerator(b)}if("string"==typeof a&&(a=parseInt(a,10)),ja=a,"object"==typeof d?(ka=d.aliasName,la=d):ka=d,qa.initializeSinceCreate=c()-qa.create,tb(ja,ka,"log",{msg:"callstats initialize in progress"}),g&&(g.disableBeforeUnloadHandler===!0&&(na=!0),null===g.applicationVersion&&void 0===g.applicationVersion||(Ka.appVer=g.applicationVersion)),Ga.tokenGenerator=b,ob("csio_auth_data"))try{var h=JSON.parse(ob("csio_auth_data"));Ga._isTokenValid(h,ja,ka)&&(e&&e(Xa.success,"SDK authentication successful."),Ga.setupAuthToken(h),Mb(),Mc._isChannelReady()||Mc._setupWebSocketConnection(e))}catch(a){console.log("initialize: Error",a)}k(),f&&(ra.stats=f);try{Ga.sendAuthenticationRequest(ja,ka,e)}catch(a){console.log("initialize: Error",a)}return Hb(Wa.success)},Kb=function(){qa.sent||(qa.remoteofferSinceCreate&&qa.config||qa.errorSinceCreate)&&(tb(ja,ka,"timing",qa),qa.sent=!0)},Lb=function(a,b){"function"==typeof b&&ra.hasOwnProperty(a)&&(ra[a]=b)},Mb=function(){var a=ea+ja,b={Authorization:"Bearer "+Ga.authToken},c=xa,d=function(a,b){200!==a.status&&setTimeout(function(){Mb()},100),qa.config=b,Kb();var c=JSON.parse(a.response);if(ta=parseInt(c.default.submissionIntervalMs,10),fa.setSubmissionInterval(ta),"adaptiveInterval"in c.default&&fa.setReportingMode(c.default.adaptiveInterval),"collectSDP"in c.default&&(ua=c.default.collectSDP),"qmodelThresholdsAPI"in c.default){var d=c.default.qmodelThresholdsAPI;Gc("eModelThreshold",d,jb),Gc("throughputThreshold",d,fb),Gc("fractionalLossThreshold",d,ib),Gc("rttThreshold",d,hb),Gc("currOverPrevFrameRateThreshold",d,gb)}ra.configService&&ra.configService(c)},e=function(){Mb()};rb(a,b,c,d,e)},Nb=function(a){return function(b){if(b.remoteUserID===a)return!0}},Ob=function(a,b){var c=!1,d=null;return La[a]&&La[a].participants&&(d=La[a].participants.filter(Nb(b))),c=!!(d&&d.length>0)},Pb=function(a){return function(b){return b.pc===a||(!(!a.callstatsID||b.pcHash!==a.callstatsID)||void 0)}},Qb=function(a,b){var c=null,d=null;return La[a]&&La[a].participants&&(d=La[a].participants.filter(Pb(b))),c=d&&d.length>0?d[0]:null},Rb=function(a,b){var c=null,d=null;return c=Qb(a,b),c&&(d=c.pcHash),d},Sb=function(a){var b=null,c=null,d=null;for(b in La)if(La.hasOwnProperty(b)&&(d=Qb(b,a))){c={fabric:d,conferenceID:b};break}return c},Tb=function(a,b){var c=0;if(a&&La[b].participants)for(c=0;c<La[b].participants.length;c++)if(La[b].participants[c].pcHash===a.pcHash){La[b].participants.splice(c,1);break}},Ub=function(a){if(a){var b=[],c=0;if(a&&a.result)b=a.result();else if(a&&a.forEach)a.forEach(function(a){b.push(a)});else for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}},Vb=function(a){var b,c=null,d=null,e=null,f=[],g=[],h=[],i=0;if(c=Ub(a),!c)return{localCandidates:f,remoteCandidates:g};for(i=0;i<c.length;++i)if(d=E(c[i]),e=B(d),e.localCandidate)f.push(e.localCandidate);else if(e.remoteCandidate)g.push(e.remoteCandidate);else if(e.Transport){if("transport"===e.Transport.type){b=e.Transport.selectedCandidatePairId;continue}h.push(e.Transport)}else e.candidatePair&&h.push(e.candidatePair);if(b)for(i=0;i<h.length;i++)h[i].id===b&&(h[i].googActiveConnection="true");return{localCandidates:f,remoteCandidates:g,iceCandidatePairs:h}},Wb=function(a){function b(b){var c={};c=Vb(b),a(c)}return b},Xb=function(a){var b=null;return a&&(b=a.message+" : "+a.stack),b},Yb=function(a,b,c,d,e,f,g,h){var i=ia.codebase,j=ia.name;if(i===kb.firefox)if(za)try{a.getStats().then(c(b,d,e,f,g,h,a)).catch(function(j){za=!1,tb(ja,d,"log",{msg:"### "+i+" getStats reports error "+Xb(j)}),a.getStats(null,c(b,d,e,f,g,h,a))})}catch(j){za=!1,tb(ja,d,"log",{msg:"### "+i+" getStats reports error "+Xb(j)}),a.getStats(null,c(b,d,e,f,g,h,a))}else a.getStats(null,c(b,d,e,f,g,h,a),function(a){console.log("getstats error ",a)});else if("Safari"===j)a.getStats().then(c(b,d,e,f,g,h,a)).catch(function(a){tb(ja,d,"log",{msg:"### "+i+" getStats reports error "+Xb(a)})});else if(i===kb.chrome)if(window&&window.csioReactNative)a.getStats(null,c(b,d,e,f,g,h,a),function(a){tb(ja,d,"log",{msg:"### "+i+" getStats reports error "+Xb(a)})});else if(za)try{a.getStats().then(c(b,d,e,f,g,h,a)).catch(function(j){za=!1,tb(ja,d,"log",{msg:"### "+i+" getStats reports error "+Xb(j)}),a.getStats(c(b,d,e,f,g,h,a))})}catch(j){za=!1,tb(ja,d,"log",{msg:"### "+i+" getStats reports error "+Xb(j)}),a.getStats(c(b,d,e,f,g,h,a))}else a.getStats(c(b,d,e,f,g,h,a));else i===kb.edge&&a.getStats().then(c(b,d,e,f,g,h,a)).catch(function(a){tb(ja,d,"log",{msg:"### "+i+" getStats reports error "+Xb(a)})})},Zb=function(a,b){try{Yb(a,b,Wb)}catch(a){console.log("csioGetStats: Error",a)}},$b=function(a,b,c,d){if(!a||!b||!c)return console.error("sendFabricEvent: Arguments missing/Invalid"),Hb(Wa.failure,"sendFabricEvent: Arguments missing/Invalid");if(!ja||!ka||!La[c])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Hb(Wa.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===Ta.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Hb(Wa.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!o(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Hb(Wa.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!Ta.hasOwnProperty(b)&&!Ua.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Hb(Wa.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var e={},f=null,g=La[c],h=null;if(void 0===g)return console.error("sendFabricEvent: Conference ID not found!"),Hb(Wa.failure,"sendFabricEvent: Conference ID not found!");if(h=Qb(c,a),null===h)return console.error("sendFabricEvent: fabricData is null"),Hb(Wa.failure,"sendFabricEvent: fabricData is null");if(f=h.remoteUserID,b===Ta.activeDeviceList){if(!d||!d.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Hb(Wa.failure,"sendFabricEvent: Arguments missing/Invalid");if(!(d.deviceList instanceof Array))return console.error("sendFabricEvent: DeviceList Invalid"),Hb(Wa.failure,"sendFabricEvent: DeviceList Invalid");e={magicKey:wb,endpoint:Ka,activeDevicelist:d.deviceList}}if(Bb(b,f,c,g.ucID,e,h.pcHash,h.pcCallback),b===Ta.fabricTerminated||b===Ua.autoFabricSetupFailed){if(La[c].participants){h&&(h.statsInterval=J(h.statsInterval),Tb(h,c));var i=N(c);i.conferenceFinished&&O(c,i.ucID)}}else b===Ta.fabricHold?(h.statsInterval=J(h.statsInterval),h.onHold=!0):b===Ta.fabricResume&&(h.onHold=!1,nc(h,a,c,f));return Hb(Wa.success)},_b=function(a){return a.length>sa&&(console.log("Log exceeds 20kb, It will be truncated"),a=a.substring(0,sa)),a},ac=function(a){return a&&"string"==typeof a?a=_b(a):a&&"object"==typeof a&&a.message&&(a.message=_b(a.message)),a},bc=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},cc=function(a,d,e,f,g,h){if(void 0===a||!e||!d)return console.error("reportError: Arguments missing/invalid"),Hb(Wa.error,"reportError: Arguments missing/invalid");if(!ja||!ka)return console.error("reportError: SDK is not initialized"),Hb(Wa.error,"reportError: SDK is not initialized");if(!db.hasOwnProperty(e))return console.error("reportError: Invalid webRTC functionName value: %o",e),Hb(Wa.error,"reportError: Invalid webRTC functionName value: "+e);void 0===f&&console.warn("reportError: Missing dom error parameter");var i,j,k=null,l=null,m=c(),n=La[d],p=null,q=m,r=null,s=null,t=null,u=null;if(t=Q(d),i=A(e),e!==db.getUserMedia&&(u=b()),f)if(window.DOMException&&f instanceof window.DOMException)f={message:f.message,name:f.name};else if("object"==typeof f){var v={};f.message&&(v.message=f.message),f.name&&(v.name=f.name),f.constraintName&&(v.constraintName=f.constraintName),f.stack&&(v.stack=f.stack),f=v}if(f=ac(f),o(a)){n&&(t=n.ucID),p=Qb(d,a),p&&(l=p.remoteUserID,q=p.startTime,r=p.pcState,s=p.pc.iceConnectionState,u=p.pcHash,j=p.pcCallback);var w=m-q;if(k={failureDelay:w,reason:i,domError:f,fabricState:r,iceConnectionState:s,function:e,magicKey:wb,endpoint:Ka},e===db.applicationLog||e===db.applicationError?Bb(Ta.applicationErrorLog,l,d,t,k,u,j):(Bb(Ta.fabricSetupFailed,l,d,t,k,u,j),qa.errorSinceCreate=c()-qa.create,Kb()),g||h||a&&a.localDescription||a&&a.remoteDescription){var x={sdp:{}};x.sdp.localSDP=bc(a,g,"localDescription"),x.sdp.remoteSDP=bc(a,h,"remoteDescription"),Cb(l,d,t,x,u)}}else null===wb&&(wb=b()),k={failureDelay:0,reason:i,domError:f,function:e,magicKey:wb,endpoint:Ka},e===db.applicationLog||e===db.applicationError?Bb(Ta.applicationErrorLog,l,d,t,k,null,null):Bb(Ta.fabricSetupFailed,l,d,t,k,u,null);return Hb(Wa.success)},dc=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b[b.length]=d:d>127&&d<2048?(b[b.length]=d>>6|192,b[b.length]=63&d|128):(b[b.length]=d>>12|224,b[b.length]=d>>6&63|128,b[b.length]=63&d|128)}return new Uint8Array(b).buffer},ec=function(a){for(var b,c=new DataView(a),d="",e=0;e<c.byteLength;e++)b=c.getUint8(e).toString(16),b.length<2&&(b="0"+b),d+=b;return d},fc=function(a,b){var c={name:"SHA-256"};if(window.crypto){var d=window.crypto.subtle||window.crypto.webkitSubtle;if(!d)return void Ib(a,b);d.digest(c,dc(a)).then(function(a){b(ec(a))}).catch(function(){Ib(a,b)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Ib(a,b);var e=window.msCrypto.subtle.digest(c,dc(a));e.oncomplete=function(a){a.target&&b(ec(a.target.result))},e.onerror=function(){Ib(a,b)}}else Ib(a,b)},gc=function(a,b,c){var d;if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Hb(Wa.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Hb(Wa.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Hb(Wa.error,"sendUserFeedback: Feedback data object must not be empty.");var e=La[a],f=null;void 0!==e&&void 0!==e.ucID&&(f=e.ucID);var g=null;if(g=null===wb?Oa:wb,null===f&&(f=Q(a)),null===f)return console.error("sendUserFeedback: ucID unavailable"),Hb(Wa.error,"sendUserFeedback: ucID unavailable");d="object"==typeof b.userID?b.userID.aliasName:b.userID,b&&b.overall<=0&&(b.overall=null);var h={conferenceID:encodeURIComponent(a),magicKey:g,appID:ja,version:aa,ucID:f,userID:encodeURIComponent(d),userQoe:{overall:b.overall}};return b.video&&(h.userQoe.video=b.video),b.audio&&(h.userQoe.audio=b.audio),b.screen&&(h.userQoe.screen=b.screen),b.comment&&(h.userQoe.comment=b.comment),Ga.authToken&&!Na?(h.token=Ga.authToken,nb("feedback",JSON.stringify(h)),R(Va.userFeedback,h,c)):(h.clockUnsynced=Na,Ba.cacheEvent({channel:Va.userFeedback,data:h,callback:c}),Ga.sendAuthenticationRequest(ja,d)),Hb(Wa.success)},hc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.aliasName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Hb(Wa.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Hb(Wa.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!o(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Hb(Wa.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=La[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Hb(Wa.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=Qb(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Hb(Wa.error,"associateMstWithUserID: Unknown pcObject passed");var j=yb(i,d);return void 0===j&&(i.ssrcMap[d]={},j=yb(i,d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==ka&&n(g,c,f,a,d),Hb(Wa.success)},ic=function(a){return window&&!window.csioproxy?(console.error("setCallstatsURLs: cannot be called if window.csioproxy is false"),Hb(Wa.error,"setCallstatsURLs: cannot be called if window.csioproxy is false")):a?(a.collectorURL&&($=a.collectorURL),a.authServiceURL&&(_=a.authServiceURL),a.csioInternalAPIURL&&(da=a.csioInternalAPIURL),a.wsURL&&(ba=a.wsURL),ya=!0,Ic(),Jc(),V(),Hb(Wa.success)):(console.error("setCallstatsURLs: Arguments missing/Invalid"),Hb(Wa.error,"setCallstatsURLs: Arguments missing/Invalid"))},jc=function(a,d,e,f,g){var h=null,i={authStatus:!!Ga.tokenData,clockSync:!Na,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:f,version:aa};if(V(),tb(ja,ka,"stateMachine",i),h="object"==typeof d?d.aliasName:d,!(a&&h&&e&&f))return console.error("addNewFabric: Arguments missing/Invalid"),Hb(Wa.error,"addNewFabric: Arguments missing/Invalid");if(g&&"function"!=typeof g)return console.error("addNewFabric: Argument missing/invalid"),Hb(Wa.failure,"addNewFabric: Argument missing/invalid");if(!ja||!ka)return console.error("addNewFabric: SDK not initialized."),Hb(Wa.error,"addNewFabric: SDK not initialized");if(""===f||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Hb(Wa.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!o(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Hb(Wa.error,"addNewFabric: Invalid PeerConnection object passed");if(!Za.hasOwnProperty(e)||e instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Hb(Wa.error,"addNewFabric: Invalid fabricUsage value");var k=c();qa.addnewfabricSinceCreate=k-qa.create,Kb(),null===wb&&(wb=b());var l=null,m=!1;if(!L(f)){var n=G(wb);Bb(Ua.userJoined,null,f,null,n,null,null),m=!0,i={authStatus:!!Ga.tokenData,clockSync:!Na,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:f,version:aa},tb(ja,ka,"stateMachine",i)}if(H(f,l,m),!Qb(f,a)){if(a&&a.addEventListener){new Z(a,xc,wc,mc,vc)}var p=b(),q={pc:a,remoteUserID:h,fabricUsage:e,magicKey:wb,startTime:k,pcCallback:g,pcState:cb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:k,pcHash:p,localSDP:-1,remoteSDP:-1,statsInterval:null,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0,currentActivePhaseIndex:0,onHold:!1,ssrcMap:{}};"function"!=typeof a||a.callstatsID||(a.callstatsID=p),"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState||(q.pcState=cb.established),M(f,q),q.pcState===cb.established&&(zc(a,Ua.autoFabricSetup,f),nc(q,a,f,h))}return j(f),Hb(Wa.success)},kc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Hb(Wa.error,"reportUserIDChange: Arguments missing/Invalid");if(!ja||!ka)return console.error("reportUserIDChange: SDK not initialized."),Hb(Wa.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Hb(Wa.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!o(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Hb(Wa.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=La[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Hb(Wa.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),tb(ja,ka,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Hb(Wa.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=Qb(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Hb(Wa.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Bb(Ta.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Hb(Wa.success)},lc=function(a){var b=null;if(a&&a.length>0){var c=a.filter(function(a){return"true"===a.selected||"true"===a.googActiveConnection||a.selected===!0||a.googActiveConnection===!0});c.length>0&&(b=c[0])}return b},mc=function(a,b){if(a){var d,e=null;if(void 0!==b){var f=b.signalingState;if(e=Sb(b),e&&e.fabric){d=e.fabric.signalingState,e.fabric.signalingState=f;var g=e.conferenceID,h=e.fabric,i=h.remoteUserID,j=La[g].ucID,k={changedState:lb.signalingState,prevState:d,newState:f};Db(b,h,g,j,i,h.pcHash,k),"closed"===f&&$b(b,Ta.fabricTerminated,e.conferenceID)}"have-remote-offer"!==f&&"stable"!==f||(qa.remoteofferSinceCreate=c()-qa.create,Kb())}}},nc=function(a,b,d,e){if(!a.onHold){var f=b,g=d,h=e;null===a.statsInterval&&(a.statsPollingStart=c(),yc(f,g,h),a.statsInterval=setInterval(function(){yc(f,g,h)},pa))}},oc=function(a,b,c,d,e,f){Zb(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=lc(b.iceCandidatePairs),f.localCandidates=b.localCandidates,Bb(Ua.iceFailed,c,d,e,f,b.pcHash,b.pcCallback)})},pc=function(a,b,c,d){var e=b.iceConnectionState,f=b.remoteUserID,g=La[c],h={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState,currPair:b.activeIceCandidatePair,failureDelay:d};b.pcState=cb.failed,"checking"===e?oc(a,b,f,c,g.ucID,h):"completed"===e||"connected"===e?Bb(Ua.fabricDropped,f,c,g.ucID,h,b.pcHash,b.pcCallback):"disconnected"===e&&b.established?Bb(Ua.fabricDropped,f,c,g.ucID,h,b.pcHash,b.pcCallback):"disconnected"===e&&oc(a,b,f,c,g.ucID,h)},qc=function(a,b,d,e){var f=b.iceConnectionState,g=b.remoteUserID,h=La[d],i=c(),j={prevIceConnectionState:f,currIceConnectionState:a.iceConnectionState,prevPair:b.activeIceCandidatePair},k=b.pcState===cb.disrupted;b.connectivityIceStatusDelay=e,b.established=!0,Zb(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=lc(b.iceCandidatePairs),j.currPair=b.activeIceCandidatePair,j.disruptionDelay=i-b.disruptedTS,k&&Bb(Ua.iceDisruptionEnd,g,d,h.ucID,j,b.pcHash,b.pcCallback)}),zc(b.pc,Ua.autoFabricSetup,d),b.pcState=cb.established,nc(b,a,d,g)},rc=function(a,b,d){var e=b.iceConnectionState,f=b.remoteUserID,g=La[d],h=c(),i={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState,prevIceConnectionStateTs:b.iceConnectionStateTS,currPair:b.activeIceCandidatePair};b.startTime=h,"connected"===e||"completed"===e?(b.pcState=cb.disrupted,b.disruptedTS=h,Bb(Ua.iceDisruptionStart,f,d,g.ucID,i,b.pcHash,b.pcCallback),b.pcCallback&&b.pcCallback(Xa.appConnectivityError,"Connectivity check for PC object to "+f+" failed.")):"checking"===e&&(b.pcState=cb.checkingDisrupted,b.disruptedTS=h,Bb(Ua.iceConnectionDisruptionStart,f,d,g.ucID,i,b.pcHash,b.pcCallback),b.pcCallback&&b.pcCallback(Xa.appConnectivityError,"Connectivity check for PC object to "+f+" failed."))},sc=function(a,b,c,d){var e=b.iceConnectionState,f=b.remoteUserID,g=La[c],h={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState};"new"===e||"checking"===e?(h.failureDelay=d,Bb(Ua.iceAborted,f,c,g.ucID,h,b.pcHash,b.pcCallback)):(h.currPair=b.activeIceCandidatePair,Bb(Ua.iceTerminated,f,c,g.ucID,h,b.pcHash,b.pcCallback))},tc=function(a,b,c){var d=b.iceConnectionState,e=b.remoteUserID,f=La[c],g={prevIceConnectionState:d,currIceConnectionState:a.iceConnectionState,prevPair:b.activeIceCandidatePair};"new"!==d&&(b.established=!1,Bb(Ua.iceRestarted,e,c,f.ucID,g,b.pcHash,b.pcCallback))},uc=function(a,b,d,e){var f=b.iceConnectionState,g=b.remoteUserID,h=La[d],i=c(),j={prevIceConnectionState:f,currIceConnectionState:a.iceConnectionState};b.gatheringIceCandidatesDelay=e,"disconnected"===f&&b.pcState===cb.checkingDisrupted&&(j.disruptionDelay=i-b.disruptedTS,Bb(Ua.iceConnectionDisruptionEnd,g,d,h.ucID,j,b.pcHash,b.pcCallback))},vc=function(a,b){if(a&&void 0!==b){var c=null;c=Sb(b),c&&c.fabric&&c.fabric.numNegotiationNeededCalls++}},wc=function(a,b){if(a&&void 0!==b){var d,e,f,g,h,i=null,j=null;if(j=Sb(b),j&&j.fabric){i=j.fabric,d=j.conferenceID,e=c(),f=e-i.startTime,g=i.iceConnectionState,h=i.iceGatheringState;var k=i.remoteUserID,l=La[d].ucID,m={changedState:lb.iceConnectionState,prevState:g,newState:b.iceConnectionState};if(Db(b,i,d,l,k,i.pcHash,m),h!==b.iceGatheringState){var n={changedState:lb.iceGatheringState,prevState:h,newState:b.iceGatheringState};Db(b,i,d,l,k,i.pcHash,n)}"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&uc(b,i,d,f),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?qc(b,i,d,f):"failed"===b.iceConnectionState?pc(b,i,d,f):"disconnected"===b.iceConnectionState?rc(b,i,d):"closed"===b.iceConnectionState?sc(b,i,d,f):"new"===b.iceConnectionState&&tc(),i.iceConnectionState=b.iceConnectionState,i.iceGatheringState=b.iceGatheringState,i.iceConnectionStateTS=c()}}},xc=function(a,b){var c,d,e;if(void 0!==b){if(null!==a.candidate){var f=a.candidate.candidate;d=f.split(" ");var g="1"===d[1]?"rtp":"rtcp";"0"!==d[5]&&(e=d[4].indexOf(":")!==-1,c={transport:d[2],protocol:g,typePreference:d[3],address:e?"["+d[4]+"]:"+d[5]:d[4]+":"+d[5],type:d[7],media:a.candidate.sdpMid})}var h=null;h=Sb(b),h&&h.fabric&&void 0!==c&&h.fabric.iceCandidates.indexOf(c)===-1&&h.fabric.iceCandidates.push(c)}},yc=function(a,b,c){if(!La.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!Ob(b,c))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",c);if("closed"===a.signalingState)return $b(a,Ta.fabricTerminated,b),!0;var d=Qb(b,a);if(d.pcState!==cb.established&&d.lastFabricState===d.pcState&&"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState)return!0;var e=La[b].ucID;try{Yb(a,d.pcCallback,z,ka,c,b,e,d)}catch(a){console.log("csioGetStats: Error",a)}},zc=function(a,b,d){var e,f=null,g=La[d],h=null,i=c();if(void 0===g&&console.error("sendAutoFabricSetupEvent: Conference ID not found!"),h=Qb(d,a),null===h&&console.error("sendAutoFabricSetupEvent: fabricData is null"),!h.fabricSetupSent){f=h.remoteUserID,e=i-h.startTime;var j={setupDelay:e,iceGatheringDelay:h.gatheringIceCandidatesDelay,iceConnectivityDelay:h.connectivityIceStatusDelay};Na||(j.clockSyncOffset=Ma.currentOffset),Zb(a,function(a){j.localCandidates=a.localCandidates,j.remoteCandidates=a.remoteCandidates,j.iceCandidatePairs=a.iceCandidatePairs,h.localCandidates=a.localCandidates,h.remoteCandidates=a.remoteCandidates,h.iceCandidatePairs=a.iceCandidatePairs,h.pcState=cb.established,h.fabricSetupSent=!0,h.activeIceCandidatePair=lc(h.iceCandidatePairs),Bb(b,f,d,g.ucID,j,h.pcHash,h.pcCallback)})}},Ac=function(a,b,c){var d={},e=null,f=La[c],g=null;void 0===f&&console.error("sendFabricTransportSwitchEvent: Conference ID not found!"),g=Qb(c,a),null===g&&console.error("sendFabricTransportSwitchEvent: fabricData is null"),e=g.remoteUserID,d.prevPair=g.activeIceCandidatePair,Zb(a,function(a){d.currPair=lc(a.iceCandidatePairs),g.activeIceCandidatePair=d.currPair,d.switchDelay=null,d.relayType=g.transportData.relayType,Bb(b,e,c,f.ucID,d,g.pcHash,g.pcCallback)})},Bc=function(a,b){if(a.trackStats){var c=a.trackStats.filter(function(a){return a.id===b});if(c.length>0)return c[0]}},Cc=function(a,b){if(a.codec){var c=a.codec.filter(function(a){return a.id===b});if(c.length>0)return c[0]}},Dc=function(a,b){if(a.candidatePair){var c=a.candidatePair.filter(function(a){return a.id===b});if(c.length>0)return c[0]}},Ec=function(a){for(var b,c,d=a.Transport.length,e=0;e<d;e++)c=a.Transport[e],c.selectedCandidatePairId&&(b=Dc(a,c.selectedCandidatePairId),b&&(a.Transport[e]=y(a.Transport[e],b)));return a},Fc=function(a){for(var b,c,d,e=a.streams.length,f=0;f<e;f++)b=a.streams[f],b.data.trackId&&(c=Bc(a,b.data.trackId),c&&(a.streams[f].data=y(a.streams[f].data,c))),b.data.codecId&&(d=Cc(a,b.data.codecId),d&&(a.streams[f].data=y(a.streams[f].data,d)));return a},Gc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},Hc=function(a,b,d){var e=[],f=null,g=null;for(var h in b)b.hasOwnProperty(h)&&e.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));var i=e.join("&"),j=new XMLHttpRequest;j.open("POST",a),j.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f=c(),j.onload=function(){g=c();var a=g-f;d(j,a)},j.send(i)},Ic=function(){rb(da,null,5e3,function(a){if(200===a.status)try{var b=JSON.parse(a.responseText);Gc("eModelThreshold",b,jb),Gc("throughputThreshold",b,fb),Gc("fractionalLossThreshold",b,ib),Gc("rttThreshold",b,hb),Gc("currOverPrevFrameRateThreshold",b,gb)}catch(a){return a}},function(){Na&&Jc()})},Jc=function(){var a=$+"clockSync",b=null,d=null;rb(a,null,5e3,function(a,e){200===a.status?(b=JSON.parse(a.response),d=c(),Kc(b,e,d)):Na&&setTimeout(function(){Jc()},100)},function(){Na&&Jc()})},Kc=function(a,b,c){if(Na){var d=b/2;if(d>Ma.maxAllowedLatency)Ma.offsetResults=[],tb(ja,ka,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;Ma.offsetResults.push(f)}if(Ma.offsetResults.length>=Ma.syncAttempts){var g=Ma.offsetResults.reduce(function(a,b){return a+b});Ma.currentOffset=g/Ma.offsetResults.length,Ma.offsetResults=[],Na=!1,tb(ja,ka,"log",{msg:"clockSync Done"}),Ba.sendCachedUserJoinedEvents(Ga),Ba.sendCachedEvents(Ga,Na)}else Na&&setTimeout(function(){Jc()},100)}},Lc=function(){var a=this,b=null,d=!1,e=!1,f={},g={initiated:"initiated",connected:"connected",closed:"closed"};this._wsConnectionState=g.closed;
var h=function(a,b){try{if(window&&window.sessionStorage){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c))}}catch(a){return}f[a]=ca+ja+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"};this.getConferenceURL=function(){return f},this._setupWebSocketConnection=function(f){return a._wsConnectionState===g.initiated||a._wsConnectionState===g.connected?(tb(ja,ka,"log",{msg:"### _setupWebSocketConnection is called when already connected!"}),void(f&&f(Xa.success,"WebSocket establishment successful."))):(a._wsConnectionState=g.initiated,b=new WebSocket(ba,"echo-protocol"),b.onopen=function(){tb(ja,ka,"log",{msg:"Successfully connected to the backend"}),a._wsConnectionState=g.connected,d?e=!0:d=!0,Ma.syncHandler||(tb(ja,ka,"log",{msg:"start clockSync"}),Ma.offsetResults=[],Jc(),Ma.syncHandler=!0),Ba.sendCachedUserJoinedEvents(Ga),e?(P(),Ba.sendCachedEvents(Ga)):Gb(),e=!1},b.onclose=function(){a._wsConnectionState=g.closed,tb(ja,ka,"log",{msg:"Connection to the server closed."}),K(),Na&&(Ma.offsetResults=[],Ma.syncHandler=null,Na=!1),b&&(b=null),f&&f(Xa.httpError,"Connection to the server closed.")},b.onerror=function(b){a._wsConnectionState=g.closed,tb(ja,ka,"log",{msg:"WebSocket establishment failed."}),f&&f(Xa.wsChannelFailure,"WebSocket establishment failed.",b)},void(b.onmessage=function(a){var b,d=a.data,e=c(),g=JSON.parse(d);if("Error"===g.status)"Invalid client token."===g.reason&&(Ga.tokenData=null,Ga.authToken=null,Ga.sendAuthenticationRequest(ja,ka)),f&&f(Xa.csProtoError,d.reason);else if("200 OK"===g.status)if("feedback"===g.event)pb("feedback");else if(g.event===Ua.userJoined||g.event===Ua.refreshPresence){var i=!1,j=null;b=decodeURIComponent(g.conferenceID);var k=function(a){return setInterval(function(){Fb(a)},va)};La.hasOwnProperty(b)&&(La[b].ucID!==g.ucID&&(i=!0,h(b,g.ucID),j=g.conferenceCreationTS?g.conferenceCreationTS:g.conferenceDuration),g.event!==Ua.userJoined||La[b].refreshPresence||(La[b].refreshPresence=k(b),W()),La[b].ucID=g.ucID),Ba.sendCachedFeedback(),Ba.sendCachedEvents(Ga,Na,i,j,b,g.ucID)}else g.event===Va.clockSync?Kc(g,e):g.event===Ta.fabricSetupFailed&&(b=decodeURIComponent(g.conferenceID),g.ucID&&(h(b,g.ucID),Ba.sendCachedFeedback(),Ba.sendCachedEvents(Ga,Na,!0,0,b,g.ucID)))}))},this._isChannelReady=function(){return!(!b||1!==b.readyState)},this.getWSConnectionState=function(){return b?b.readyState:-1},this.send=function(a){b.send(JSON.stringify(a))}},Mc=new Lc,Nc=function(a,b,c){if(Mc._isChannelReady())try{Mc.send(b)}catch(d){d&&"InvalidStateError"===d.name&&Ba.cacheEvent({channel:a,data:b,callback:c})}else Ba.cacheEvent({channel:a,data:b,callback:c}),Mc._setupWebSocketConnection()};return f(),qb(),window&&!window.csioproxy&&(ya=!0,Ic(),Jc()),window&&window.csioChromeLegacyGetStats&&(za=!1),{version:aa,initialize:Jb,on:Lb,fabricEvent:Ta,addNewFabric:jc,sendFabricEvent:$b,sendUserFeedback:gc,associateMstWithUserID:hc,csError:Xa,fabricUsage:Za,qualityRating:_a,webRTCFunctions:db,reportError:cc,reportUserIDChange:kc,userIDType:$a,setProxyConfig:ic,callStatsAPIReturnStatus:Wa}}"function"==typeof define&&define.amd?define("callstats",[],d):c.callstats=d,b.exports=d}("undefined"!=typeof window?window:"undefined"!=typeof c?c:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./callstatsUtils":3,"./pcCallbackHandler":4,"./statsReporter":6}],3:[function(a,b,c){"use strict";function d(){}d.prototype.measureAppLoadingPerformance=function(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0},d.prototype.detectBrowserInfo=function(){var a="Chrome",b=null,c=null,d=null,e={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"},f=e.goog;if(!window.navigator.userAgent||window.csioReactNative)return console.log("Invalid userAgent"),window&&window.csioGetOsName&&(b=window.csioGetOsName()),window&&window.csioGetOsVer&&(c=window.csioGetOsVer()),window&&window.csioReactNative&&(d="react-native"),{name:a,codebase:f,os:b,osVersion:c,userAgent:d};d=navigator.userAgent;var g,h=d.toLowerCase(),i=navigator.appVersion,j=""+parseFloat(navigator.appVersion);(g=h.indexOf("opera"))!==-1?(a="Opera",j=h.substring(g+6),(g=h.indexOf("Version"))!==-1&&(j=h.substring(g+8)),f=e.goog):(g=h.indexOf("opr"))!==-1?(a="Opera",j=h.substring(g+4),(g=h.indexOf("Version"))!==-1&&(j=h.substring(g+8)),f=e.goog):(g=h.indexOf("msie"))!==-1?(a="Microsoft Internet Explorer",j=h.substring(g+5),f=e.goog):(g=h.indexOf("edge"))!==-1?(a=e.edge,j=h.substring(g+5),f=e.edge):(g=h.indexOf("chrome"))!==-1?(a=e.goog,j=h.substring(g+7),f=e.goog):(g=h.indexOf("safari"))!==-1?(a="Safari",j=h.substring(g+7),(g=h.indexOf("version"))!==-1&&(j=h.substring(g+8)),f=e.goog):(g=h.indexOf("firefox"))!==-1?(a="Firefox",j=h.substring(g+8),f=e.moz):(g=h.indexOf("trident"))!==-1&&(a="Microsoft Internet Explorer",g=h.indexOf("rv"),j=h.substring(g+3,g+7),f=e.goog);var k,l,m=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}];for(k in m)if(l=m[k],l.r.test(h)){b=l.s;break}switch(b&&/Windows/.test(b)&&(c=/Windows (.*)/.exec(b)[1],b="Windows"),b){case"Mac OS X":c=/mac os x (10[\.\_\d]+)/.exec(h)[1];break;case"Android":c=/android ([\.\_\d]+)/.exec(h)[1];break;case"iOS":c=/os (\d+)_(\d+)_?(\d+)?/.exec(i),c=c[1]+"."+c[2]+"."+(0|c[3])}return{name:a,ver:j.toString(),os:b,osVersion:c,codebase:f,userAgent:d}},b.exports=d},{}],4:[function(a,b,c){function d(a,b,c,d,e){this.pc=a,this.onIceCandidateCallback=b,this.onIceConnectionStateChangeCallback=c,this.onPcSignalingStateChangeCallback=d,this.onPcNegotiationNeededCallback=e,this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.pcSignalingStateChangeCallback.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1)}d.prototype.iceCandidateCallback=function(a){try{this.onIceCandidateCallback(a,this.pc)}catch(a){console.log("onIceCandidateCallback: Error",a)}},d.prototype.iceConnectionStateChangeCallback=function(a){try{this.onIceConnectionStateChangeCallback(a,this.pc)}catch(a){console.log("onIceConnectionStateChangeCallback: Error",a)}},d.prototype.pcSignalingStateChangeCallback=function(a){try{this.onPcSignalingStateChangeCallback(a,this.pc)}catch(a){console.log("onPcSignalingStateChangeCallback: Error",a)}},d.prototype.pcNegotiationNeededCallback=function(a){try{this.onPcNegotiationNeededCallback(a,this.pc)}catch(a){console.log("onPcNegotiationNeededCallback: Error",a)}},b.exports=d},{}],5:[function(a,b,c){function d(a,b){this.items=[],this.plugins=[],this.timeoutInMs=b,this.maxItemsNum=a,this.minItemsNum=0,this.last=null}var e=a("./swItem");d.prototype={constructor:d,signalize:function(a,b){for(var c=0;c<this.plugins.length;++c){var d=this.plugins[c];null!==d.signalize&&void 0!==d.signalize?d.signalize.call(d,a,b):console.warn(d)}},toString:function(){return""}},d.prototype.getLast=function(){return this.last},d.prototype.setMaxItemsNum=function(a){this.maxItemsNum=a},d.prototype.setTimeoutInMs=function(a){this.timeoutInMs=a},d.prototype.setMinItemsNum=function(a){this.minItemsNum=a},d.prototype.refresh=function(){if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();0<this.timeoutInMs&&this.timeoutInMs<this.items[0].getElapsed()&&(this.remove(),this.refresh())}},d.prototype.getItemsNum=function(){return this.items.length},d.prototype.add=function(a){this.refresh(),this.items.push(new e(a));for(var b=0;b<this.plugins.length;b++){var c=this.plugins[b];c.add(a)}this.last=a},d.prototype.map=function(a){for(var b=0;b<this.plugins.length;b++){var c=this.plugins[b];c.map(a)}},d.prototype.remove=function(){for(var a=this.items.shift(),b=0;b<this.plugins.length;b++){var c=this.plugins[b];c.remove(a.value)}},d.prototype.foreach=function(a,b){var c=this.items;void 0!==b&&(c=b(c));for(var d=0;d<c.length;d++){var e=c[d];a(e.value)}},d.prototype.addPlugin=function(a){this.plugins.push(a)},b.exports=d},{"./swItem":8}],6:[function(a,b,c){function d(){this.invoker=null,this.receiver=null}function e(){this.listeners=[]}function f(a){this.stats=null,this.lastResponsed=(new Date).getTime(),this.onDataSent=a}function g(a){this.ssrc=null,this.direction=void 0,this.mediaType=null,this.resolution=null,this.frameRateReceived=null,this.frameWidth=null,this.rtt=null,this.droppedFramesNum=null,this.packetLosts=null,this.jitter=null,this.bytesReceived=-1,this.packetsReceived=-1,this.packetsDiscarded=-1,this.bytesSent=-1,this.packetsSent=-1,this.stream=a}function h(a,b){return a.rtt===b.rtt?0:a.rtt<b.rtt?-1:1}function i(a,b){return a.frameHeight===b.frameHeight?0:a.frameHeight<b.frameHeight?-1:1}function j(a,b){return a.frameWidth===b.frameWidth?0:a.frameWidth<b.frameWidth?-1:1}function k(a,b){return a.jitter===b.jitter?0:a.jitter<b.jitter?-1:1}function l(a,b){var c=parseInt(a.frameRateReceived),d=parseInt(b.frameRateReceived);return c===d?0:c<d?-1:1}function m(a,b){return a}function n(){this.codeBase=null,this.mediaType={unknown:"unknown",audio:"audio",video:"video"},this.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge"}}function o(a){E.call(this),this.extractorFnc=a,this.prev=0,this.delta=0,this.first=0,this.actual=0,this.addSignalListener(C.Signals.onDataSent,this.onDataSent,this)}function p(a){E.call(this),this.extractorFnc=a,this.prev=null}function q(a,b){this.intervalPacketsRecv=b,this.intervalLoss=a}function r(a,b){var c=a.getValue(),d=b.getValue();return c===d?0:c<d?-1:1}function s(a,b){var c=(a.getIntervalLoss()+b.getIntervalLoss())/2,d=(a.getIntervalPacketsRecv()+b.getIntervalPacketsRecv())/2;return new q(c,d)}function t(){this.measurements=new D(C.maxItemsNum,C.timeoutInMs),this.packetLostTracker=new o(function(a){return a.packetLosts}),this.measurements.addPlugin(this.packetLostTracker),this.packetsDiscardedTracker=new o(function(a){return a.packetsDiscarded}),this.measurements.addPlugin(this.packetsDiscardedTracker),this.resolutionTracker=new p(function(a){return a.resolution}),this.measurements.addPlugin(this.resolutionTracker),this.jitter95PercentileTracker=new F(k,95,m),this.measurements.addPlugin(this.jitter95PercentileTracker),this.jitter95PercentileTracker.addFilter(function(a){return void 0!==a.jitter&&null!==a.jitter}),this.rtt95PercentileTracker=new F(h,95,m),this.measurements.addPlugin(this.rtt95PercentileTracker),this.rtt95PercentileTracker.addFilter(function(a){return void 0!==a.rtt&&null!==a.rtt&&0<a.rtt}),this.frameHeight50PercentileTracker=new F(i,50,m),this.measurements.addPlugin(this.frameHeight50PercentileTracker),this.frameHeight50PercentileTracker.addFilter(function(a){return void 0!==a.frameHeight&&null!==a.frameHeight&&0<a.frameHeight}),this.frameHeight95PercentileTracker=new F(i,95,m),this.measurements.addPlugin(this.frameHeight95PercentileTracker),this.frameHeight95PercentileTracker.addFilter(function(a){return void 0!==a.frameHeight&&null!==a.frameHeight&&0<a.frameHeight}),this.frameRate50PercentileTracker=new F(l,50,m),this.measurements.addPlugin(this.frameRate50PercentileTracker),this.frameRate50PercentileTracker.addFilter(function(a){return void 0!==a.frameRateReceived&&null!==a.frameRateReceived}),this.frameRate95PercentileTracker=new F(l,95,m),this.measurements.addPlugin(this.frameRate95PercentileTracker),this.frameRate95PercentileTracker.addFilter(function(a){return void 0!==a.frameRateReceived&&null!==a.frameRateReceived}),this.frameWidth50PercentileTracker=new F(j,50,m),this.measurements.addPlugin(this.frameWidth50PercentileTracker),this.frameWidth50PercentileTracker.addFilter(function(a){return void 0!==a.frameWidth&&null!==a.frameWidth&&0<a.frameWidth}),this.frameWidth95PercentileTracker=new F(j,95,m),this.measurements.addPlugin(this.frameWidth95PercentileTracker),this.frameWidth95PercentileTracker.addFilter(function(a){return void 0!==a.frameWidth&&null!==a.frameWidth&&0<a.frameWidth}),this.rttAvgRTTracker=new G(function(a){return a.rtt}),this.measurements.addPlugin(this.rttAvgRTTracker),this.rttAvgRTTracker.addFilter(function(a){return void 0!==a.rtt&&null!==a.rtt&&0<a.rtt}),this.frameRateMeanTracker=new G(function(a){return a.frameRateReceived}),this.measurements.addPlugin(this.frameRateMeanTracker),this.frameRateMeanTracker.addFilter(function(a){return void 0!==a.frameRateReceived&&null!==a.frameRateReceived&&0<a.frameRateReceived}),this.frameHeightMeanTracker=new G(function(a){return a.frameHeight}),this.measurements.addPlugin(this.frameHeightMeanTracker),this.frameHeightMeanTracker.addFilter(function(a){return void 0!==a.frameHeight&&null!==a.frameHeight&&0<a.frameHeight}),this.frameWidthMeanTracker=new G(function(a){return a.frameWidth}),this.measurements.addPlugin(this.frameWidthMeanTracker),this.frameWidthMeanTracker.addFilter(function(a){return void 0!==a.frameHeight&&null!==a.frameWidth&&0<a.frameWidth}),this.jitterAvgTracker=new G(function(a){return a.jitter}),this.measurements.addPlugin(this.jitterAvgTracker),this.jitterAvgTracker.addFilter(function(a){return void 0!==a.jitter&&null!==a.jitter&&0<a.jitter}),this.intervalFractionLosts=new D(C.maxItemsNum,C.timeoutInMs),this.FLPercentileTracker=new F(r,95,s),this.intervalFractionLosts.addPlugin(this.FLPercentileTracker),this.deltaAdded=0,this.firstAdded=0,this.lastAdded=0,this.doSending=!1}function u(){t.call(this),this.bytesReceivedTracker=new o(function(a){return a.bytesReceived}),this.packetsReceivedTracker=new o(function(a){return a.packetsReceived}),this.addPlugin(this.bytesReceivedTracker),this.addPlugin(this.packetsReceivedTracker)}function v(){u.call(this),this.quality={eModel:0,bandwidth:0}}function w(){u.call(this),this.frameRateReceivedTracker=new o(function(a){return a.frameRateReceived}),this.frameRatePercTracker=new F(l,10,m),this.frameRatePercTracker.addFilter(function(a){return void 0!==a.frameRateReceived&&null!==a.frameRateReceived}),this.frameRatePercTracker.attach(this.setFrameRateReceived10,this),this.frameRateReceived10=null,this.addPlugin(this.frameRatePercTracker),this.addPlugin(this.frameRateReceivedTracker),this.quality={eModel:0,bandwidth:0,frameRate:0}}function x(){t.call(this),this.bytesSentTracker=new o(function(a){return a.bytesSent}),this.packetsSentTracker=new o(function(a){return a.packetsSent}),this.addPlugin(this.bytesSentTracker),this.addPlugin(this.packetsSentTracker)}function y(){x.call(this),this.frameRateReceivedTracker=new o(function(a){return a.frameRateReceived}),this.frameRatePercTracker=new F(l,10,m),this.frameRatePercTracker.addFilter(function(a){return void 0!==a.frameRateReceived&&null!==a.frameRateReceived}),this.frameRatePercTracker.attach(this.setFrameRateReceived10,this),this.frameRateReceived10=null,this.addPlugin(this.frameRatePercTracker),this.addPlugin(this.frameRateReceivedTracker),this.quality={eModel:0,bandwidth:0,frameRate:0}}function z(){x.call(this),this.quality={eModel:0,bandwidth:0}}function A(){this.monitors={},this.assembler=new n,this.sendable=!1}function B(a){this.monitors=new A,this.output=new d,this.lastForwarded=(new Date).getTime(),this.lastInterval=0,a.addListener(this.monitors.onDataSent,this.monitors)}function C(){this.states={Idle:"Idle",Run:"Run"},this.events={OnPolling:"OnPolling",OnStatsRequest:"OnStatsRequest",OnStop:"OnStop",OnStart:"OnStart"},this.onDataSent=new e,this.analyzer=new B(this.onDataSent),this.senderGate=new f(this.onDataSent),this.analyzer.output.connect(this.senderGate.receiver,this.senderGate),this.currentState=this.states.Run}var D=a("./slidingWindow"),E=a("./swPlugin"),F=a("./swPercentileTracker"),G=a("./swAvg");C.adaptiveSending=!0,C.minMeasurementsNum=20,C.SendingTimeTresholds={max:3e4,min:1e3,regular:5e3},C.maxItemsNum=1e3,C.timeoutInMs=3e5,C.Signals={onDataSent:"onDataSent"},d.prototype={constructor:d,connect:function(a,b){this.invoker=void 0===b?null:b,this.receiver=a},send:function(a){return null===this.receiver?void console.warn("There is no receiver to call"):null===this.invoker?void this.receiver(a):void this.receiver.call(this.invoker,a)}},e.prototype={constructor:e,addListener:function(a,b){this.listeners.push({callback:a,that:b})},notify:function(){for(var a=0;a<this.listeners.length;++a){var b=this.listeners[a];void 0!==b.callback&&null!==b.callback&&(null===b.that?b.callback():b.callback.call(b.that))}}},f.prototype={constructor:f,receiver:function(a){this.stats=a},requestStats:function(){var a=null,b=(new Date).getTime();return null===this.stats?null:b-C.SendingTimeTresholds.min<this.lastResponsed?null:(a={streams:this.stats},this.stats=null,this.lastResponsed=b,this.onDataSent.notify(),a)}},g.MediaTypes={audio:"audio",video:"video"},g.Direction={inbound:"inbound",outbound:"outbound"},g.prototype={constructor:g,toString:function(){return"Measurement {RTT: "+this.RTT+"; }"}},n.prototype={constructor:n,do:function(a,b){var c=new g(a);if(c.ssrc=a.ssrc,c.mediaType=this.getMediaType(a),c.resolution=this.getResolution(a),c.frameRateReceived=this.getFrameRate(a),c.frameWidth=this.getFrameWidth(a),c.frameHeight=this.getFrameHeight(a),c.rtt=this.getLatencyData(a),c.droppedFramesNum=this.getDroppedFramesNum(a),c.packetLosts=this.getPacketLosts(a),c.jitter=this.getJitter(a),a.streamType===g.Direction.inbound?(c.direction=g.Direction.inbound,c.bytesReceived=this.getBytesReceived(a),c.packetsReceived=this.getPacketsReceived(a),c.packetsDiscarded=this.getPacketsDiscarded(a)):a.streamType===g.Direction.outbound&&(c.direction=g.Direction.outbound,c.bytesSent=this.getBytesSent(a),c.packetsSent=this.getPacketsSent(a)),void 0!==b&&b===!0){c.rawdats={};for(var d in a.data)a.data.hasOwnProperty(d)&&(c.rawdats[d]=a.data[d])}return c},setupCodeBase:function(a){this.codeBase=a},getBytesSent:function(a){if(void 0===a.data.bytesSent)return 0;var b=this.checkForNan(parseInt(a.data.bytesSent,10));return null!==b?b:0},getBytesReceived:function(a){if(void 0===a.data.bytesReceived)return 0;var b=this.checkForNan(parseInt(a.data.bytesReceived,10));return null!==b?b:0},getPacketsReceived:function(a){if(void 0===a.data.packetsReceived)return 0;var b=this.checkForNegativeValue(parseInt(a.data.packetsReceived,10));return null!==b?b:0},getPacketsSent:function(a){if(void 0===a.data.packetsSent)return 0;var b=this.checkForNegativeValue(parseInt(a.data.packetsSent,10));return null!==b?b:0},getPacketsDiscarded:function(a){if(void 0===a.data.discardedPackets)return 0;var b=this.checkForNan(parseInt(a.data.discardedPackets,10));return null!==b?b:0},getPacketLosts:function(a){if(void 0===a.data.packetsLost)return 0;var b=this.checkForNegativeValue(parseInt(a.data.packetsLost,10));return null!==b?b:0},getDroppedFramesNum:function(a){if(void 0===a.data.droppedFrames)return 0;var b=this.checkForNegativeValue(parseInt(a.data.droppedFrames,10));return null!==b?b:0},getFrameRate:function(a){var b;return this.codeBase===this.codeBaseType.chrome?void 0!==a.data.googFrameRateOutput?b=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?b=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?b=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(b=parseInt(a.data.googFrameRateSent,10)):this.codeBase===this.codeBaseType.firefox&&void 0!==a.data.framerateMean&&(b=parseInt(a.data.framerateMean,10)),void 0!==b&&(b=isNaN(b)||b<0?null:b),b},getFrameHeight:function(a){var b;return this.codeBase===this.codeBaseType.chrome?void 0!==a.data.googFrameHeightReceived?b=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent?b=a.data.googFrameHeightSent:void 0!==a.data.frameHeight&&(b=a.data.frameHeight):this.codeBase===this.codeBaseType.firefox,b},getJitter:function(a){if(void 0!==a){var b;return this.codeBase===this.codeBaseType.chrome&&void 0!==a.data.googJitterReceived?(b=this.checkForNan(parseInt(a.data.googJitterReceived,10)),b?b/1e3:b):this.codeBase===this.codeBaseType.chrome&&void 0!==a.data.jitter?(b=this.checkForNan(parseInt(a.data.jitter,10)),b?b/1e3:b):this.codeBase===this.codeBaseType.firefox&&void 0!==a.data.jitter?this.checkForNan(parseInt(a.data.jitter,10)):void 0}},getResolution:function(a){var b,c,d,e="unavailable";return b=this.getFrameRate(a),d=this.getFrameWidth(a),c=this.getFrameHeight(a),void 0!==b&&void 0!==d&&void 0!==c&&d>0&&c>0&&(e=d.concat("x",c,"@",b)),e},getFrameWidth:function(a){var b;return this.codeBase===this.codeBaseType.chrome?void 0!==a.data.googFrameWidthReceived?b=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent?b=a.data.googFrameWidthSent:void 0!==a.data.frameWidth&&(b=a.data.frameWidth):this.codeBase===this.codeBaseType.firefox,b},validateRTT:function(a){var b;return b=isNaN(a)||a<0?null:a},getLatencyData:function(a){return void 0===a?null:this.codeBase===this.codeBaseType.chrome&&void 0!==a.data.googRtt?this.validateRTT(parseInt(a.data.googRtt,10)):this.codeBase===this.codeBaseType.chrome&&void 0!==a.data.roundTripTime?this.validateRTT(parseInt(a.data.roundTripTime,10)):this.codeBase===this.codeBaseType.firefox&&void 0!==a.data.mozRtt?this.validateRTT(parseInt(a.data.mozRtt,10)):this.codeBase===this.codeBaseType.edge&&a.data.roundTripTime?this.validateRTT(parseInt(a.data.roundTripTime,10)):null},getMediaType:function(a){var b=this.mediaType.unknown,c=null;if(void 0!==a){if(a.data&&void 0!==a.data.mediaType)return a.data.mediaType;if(this.codeBase===this.codeBaseType.chrome)a.data.mediaType?b=a.data.mediaType:void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?b=this.mediaType.video:void 0===a.data.audioInputLevel&&void 0===a.data.audioOutputLevel||(b=this.mediaType.audio),c=a.data.googCodecName;else{if(this.codeBase!==this.codeBaseType.firefox)return b;void 0!==a.data.framerateMean&&(b=this.mediaType.video)}return b}},checkForNan:function(a){var b=isNaN(a)?null:a;return b},checkForNegativeValue:function(a){if(a=this.checkForNan(a),null!==a){var b=a<0?null:a;return b}},toString:function(){return"ToString function is not defined. for this object"}},o.prototype=Object.create(E.prototype),o.prototype.constructor=o,o.prototype.onDataSent=function(){this.delta=this.actual-this.prev,this.prev=this.actual},o.prototype.getActual=function(){return this.actual},o.prototype.getFirst=function(){return this.first},o.prototype.getDelta=function(){return this.delta},o.prototype.getPrevious=function(){return this.prev},o.prototype.add=function(a){var b=this.extractorFnc(a);if(void 0!==b&&null!==b){if(0===this.first)return void(this.first=b);this.actual=b,this.notify({last:this.prev,delta:this.delta})}},o.prototype.remove=function(){},p.prototype=Object.create(E.prototype),p.prototype.constructor=p,p.prototype.add=function(a){void 0!==a&&null!==a&&(this.prev=this.extractorFnc(a))},p.prototype.remove=function(){},p.prototype.getPrevious=function(){return this.prev},q.prototype={constructor:q,getIntervalLoss:function(){return this.intervalLoss},getIntervalPacketsRecv:function(){return this.intervalPacketsRecv},getValue:function(){return void 0===this.intervalPacketsRecv||void 0===this.intervalLoss?null:null===this.intervalPacketsRecv||null===this.intervalLoss?null:0===this.intervalLoss&&0===this.intervalPacketsRecv?0:this.intervalLoss/(this.intervalPacketsRecv+this.intervalLoss)}},t.VideoThroughputThresholds={green:1024,red:256},t.AudioThroughputThresholds={green:30,red:8},t.FrameRateRatioTresholds={green:.8,red:.3},t.VideoRTTThresholds={green:400,red:1e3},t.VideoFractionLostTreshdolds={green:10,red:50},t.AudioFractionLostTresholds={green:15,red:30},t.AudioEModelTresholds={green:240,red:400},t.avQualityRating={excellent:3,fair:2,bad:1},t.avQualityRatingString={excellent:"excellent",fair:"fair",bad:"bad"},t.prototype={constructor:t,doStart:function(){return!0},getTotalTimeInMs:function(){return 0===this.firstAdded?0:this.lastAdded-this.firstAdded},getDeltaTimeInMs:function(){return 0===this.firstAdded?0:this.deltaAdded},getLastMeasurement:function(){return this.measurements.getLast()},add:function(a){var b=(new Date).getTime();if(0===this.firstAdded){if(!this.doStart(a))return;this.firstAdded=b,this.lastAdded=b}this.measurements.add(a)},requestSending:function(){this.doSending=!0},requestSendingIf:function(a,b){this.doSending=this.doSending||a},getAvgRTT:function(){return this.rttAvgRTTracker.getResult()},getResolution:function(){return this.resolutionTracker.getPrevious()},percentileTrackerExtractor:function(a,b,c){var d=null,e=a.getResult();return null===e?c:(d=b(e.actual),null===d?c:d)},getRTT95:function(){var a=this.percentileTrackerExtractor(this.rtt95PercentileTracker,function(a){return a.rtt},null),b=this.getLastMeasurement();if(null!==b&&null!==a){var c=Math.max(.1*a,100);this.requestSendingIf(a+c<b.rtt,"RTT95 the reason of sending "+a+" < "+b.rtt)}return a},getJitter95:function(){var a=this.percentileTrackerExtractor(this.jitter95PercentileTracker,function(a){return a.jitter},null),b=this.getLastMeasurement();if(null!==b){var c=Math.max(.1*a,10);this.requestSendingIf(a+c<b.jitter,"RTT95 the reason of sending "+a+" < "+b.rtt)}return this.result},getFrameRateMean:function(){return this.frameRateMeanTracker.getResult()},getFrameWidth50Percentile:function(){return this.percentileTrackerExtractor(this.frameWidth50PercentileTracker,function(a){return a.frameWidth},null)},getFrameWidth95Percentile:function(){return this.percentileTrackerExtractor(this.frameWidth95PercentileTracker,function(a){return a.frameWidth},null)},getFrameHeight50Percentile:function(){return this.percentileTrackerExtractor(this.frameHeight50PercentileTracker,function(a){return a.frameHeight},null)},getFrameHeight95Percentile:function(){return this.percentileTrackerExtractor(this.frameHeight95PercentileTracker,function(a){return a.frameHeight},null)},getFrameRate50Percentile:function(){return this.percentileTrackerExtractor(this.frameRate50PercentileTracker,function(a){return a.frameRateReceived},null)},getFrameRate95Percentile:function(){return this.percentileTrackerExtractor(this.frameRate95PercentileTracker,function(a){return a.frameRateReceived},null)},getFrameHeightMean:function(){return this.frameHeightMeanTracker.getResult()},getFrameWidthMean:function(){return this.frameWidthMeanTracker.getResult()},getAvgJitter:function(){return this.jitterAvgTracker.getResult()},getQualityEvaluation:function(a,b){if(void 0!==a&&void 0!==b){if(null===a||null===a)return null;var c;return c=b.green<=a?t.avQualityRating.excellent:b.red<a&&a<b.green?t.avQualityRating.fair:t.avQualityRating.bad}},getQualityReverseEvaluation:function(a,b){if(void 0!==a&&void 0!==b){if(null===a||null===a)return null;var c;return c=b.red<a?t.avQualityRating.bad:b.green<=a&&a<=b.red?t.avQualityRating.fair:t.avQualityRating.excellent}},hasData:function(){return this.measurements.refresh(),1<this.measurements.getItemsNum()},addPlugin:function(a){this.measurements.addPlugin(a)},setup:function(a){a.data.csioIntBRKbps=void 0,a.data.csioAvgBRKbps=void 0,a.data.csioIntFL=void 0,a.data.csioIntMs=this.getDeltaTimeInMs(),a.data.csioIntPR=void 0,a.data.csioPercentileFl=void 0,a.data.csioAvgJitter=this.getAvgJitter(),a.data.csioAvgRtt=this.getAvgRTT(),a.data.csioPercentileJitter=this.getJitter95(),a.data.csioSig2Latency=this.getRTT95(),a.data.csioTimeElapseMs=this.getTotalTimeInMs(),a.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,a.data.csiores=this.getResolution(),a.data.csioFrameWidth95Percentile=this.getFrameWidth95Percentile(),a.data.csioFrameWidth50Percentile=this.getFrameWidth50Percentile(),a.data.csioFrameHeight95Percentile=this.getFrameHeight95Percentile(),a.data.csioFrameHeight50Percentile=this.getFrameHeight50Percentile(),a.data.csioFrameRate95Percentile=this.getFrameRate95Percentile(),a.data.csioFrameRate50Percentile=this.getFrameRate50Percentile(),a.data.csioFrameWidthMean=this.getFrameWidthMean(),a.data.csioFrameHeightMean=this.getFrameHeightMean(),a.data.csioFrameRateMean=this.getFrameRateMean()},addIntervalFractionLost:function(a){this.intervalFractionLosts.add(a)},getLastFractionLost:function(){return this.intervalFractionLosts.getLast()},getIntervalFractionLost95:function(){var a,b=this.FLPercentileTracker.getResult();return null===b?0:a=b.actual.getValue()},onDataSent:function(){var a=(new Date).getTime();this.measurements.signalize(C.Signals.onDataSent,null),this.deltaAdded=a-this.lastAdded,this.lastAdded=a},isValid:function(){for(var a=0;a<arguments.length;a++)if(null===arguments[a]||void 0===arguments[a])return!1;return!0},doSend:function(){if(this.hasData()===!1)return!0;var a=this.doSending;return this.doSending=!1,a}},u.prototype=Object.create(t.prototype),u.prototype.constructor=u,u.prototype.setRTT95=function(a){t.prototype.setRTT95(a)},u.prototype.setup=function(a){t.prototype.setup.call(this,a);var b=new q(this.packetLostTracker.getDelta(),this.packetsReceivedTracker.getDelta());this.addIntervalFractionLost(b),a.data.csioIntPktRcv=this.packetsReceivedTracker.getDelta(),a.data.csioIntBRKbps=8*this.bytesReceivedTracker.getDelta()/this.getDeltaTimeInMs(),a.data.csioAvgBRKbps=8*this.bytesReceivedTracker.getPrevious()/this.getTotalTimeInMs(),a.data.csioIntFL=b.getValue(),a.data.csioIntPR=this.packetsReceivedTracker.getDelta()/(this.getDeltaTimeInMs()/1e3),a.data.csioPercentileFl=this.getIntervalFractionLost95(),a.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,void 0!==a.data.csioAvgBRKbps&&null!==a.data.csioAvgBRKbps?a.data.csioAvgPacketSize=this.bytesReceivedTracker.getDelta()/this.packetsReceivedTracker.getDelta():a.data.csioAvgPacketSize=null,a.data.csioPktLossPercentage=this.packetLostTracker.getDelta()/this.packetsReceivedTracker.getDelta()*100},v.prototype=Object.create(u.prototype),v.prototype.constructor=v,v.prototype.setup=function(a){u.prototype.setup.call(this,a),a.data.csioMediaType=g.MediaTypes.audio,this.quality.eModel=this.getQualityReverseEvaluation(a.data.csioeM,t.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(a.data.csioIntBRKbps,t.AudioThroughputThresholds),a.data.csioMark=this.getQuality()},v.prototype.getQuality=function(){var a=0,b=.5*this.quality.bandwidth+.5*this.quality.eModel;return b=Math.floor(b),b===t.avQualityRating.excellent?a=t.avQualityRatingString.excellent:b===t.avQualityRating.fair?a=t.avQualityRatingString.fair:b===t.avQualityRating.bad&&(a=t.avQualityRatingString.bad),
a},w.prototype=Object.create(u.prototype),w.prototype.constructor=w,w.prototype.setFrameRatioQuality=function(){var a=this.frameRateReceivedTracker.getActual(),b=this.frameRateReceivedTracker.getPrevious(),c=0;this.quality.frameRate=0,void 0!==a&&void 0!==b&&null!==a&&null!==b&&0!==b&&(c=a/b,this.quality.frameRate=this.getQualityEvaluation(c,t.FrameRateRatioTresholds))},w.prototype.setFrameRateReceived10=function(a){return null===a?void(this.frameRateReceived10=null):void(this.frameRateReceived10=a.actual)},w.prototype.setup=function(a){u.prototype.setup.call(this,a),a.data.csioMediaType=g.MediaTypes.video,this.setFrameRatioQuality(),this.quality.eModel=this.getQualityReverseEvaluation(a.data.csioeM,t.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(a.data.csioIntBRKbps,t.VideoThroughputThresholds),a.data.csioMark=this.getQuality()},w.prototype.getQuality=function(){var a=0,b=.33*this.quality.bandwidth+.33*this.quality.eModel+.33*this.quality.frameRate;return b=Math.floor(b),b===t.avQualityRating.excellent?a=t.avQualityRatingString.excellent:b===t.avQualityRating.fair?a=t.avQualityRatingString.fair:b===t.avQualityRating.bad&&(a=t.avQualityRatingString.bad),a},x.prototype=Object.create(t.prototype),x.prototype.constructor=x,x.prototype.setup=function(a){t.prototype.setup.call(this,a);var b=new q(this.packetLostTracker.getDelta(),this.packetsSentTracker.getDelta());this.addIntervalFractionLost(b);var c=8*this.bytesSentTracker.getDelta()/this.getDeltaTimeInMs();a.data.csioIntBRKbps=c,a.data.csioAvgBRKbps=8*this.bytesSentTracker.getPrevious()/this.getTotalTimeInMs(),a.data.csioIntFL=b.getValue(),a.data.csioIntPR=this.packetsSentTracker.getDelta()/(this.getDeltaTimeInMs()/1e3),a.data.csioIntPktRcv=this.packetsSentTracker.getDelta(),a.data.csioPercentileFl=this.getIntervalFractionLost95(),a.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,void 0!==a.data.csioAvgBRKbps&&null!==a.data.csioAvgBRKbps?a.data.csioAvgPacketSize=this.bytesSentTracker.getDelta()/this.packetsSentTracker.getDelta():a.data.csioAvgPacketSize=null,a.data.csioPktLossPercentage=this.packetLostTracker.getDelta()/this.packetsSentTracker.getDelta()*100},y.prototype=Object.create(x.prototype),y.prototype.constructor=y,y.prototype.setFrameRatioQuality=function(){var a=this.frameRateReceivedTracker.getActual(),b=this.frameRateReceivedTracker.getPrevious(),c=0;this.quality.frameRate=0,void 0!==a&&void 0!==b&&null!==a&&null!==b&&0!==b&&(c=a/b,this.quality.frameRate=this.getQualityEvaluation(c,t.FrameRateRatioTresholds))},y.prototype.setFrameRateReceived10=function(a){return null===a?void(this.frameRateReceived10=null):void(this.frameRateReceived10=a.actual)},y.prototype.setup=function(a){x.prototype.setup.call(this,a),a.data.csioMediaType=g.MediaTypes.video,this.setFrameRatioQuality(),this.quality.eModel=this.getQualityReverseEvaluation(a.data.csioeM,t.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(a.data.csioIntBRKbps,t.VideoThroughputThresholds),a.data.csioMark=this.getQuality()},y.prototype.getQuality=function(){var a=0,b=.33*this.quality.bandwidth+.33*this.quality.eModel+.33*this.quality.frameRate;return b=Math.floor(b),b===t.avQualityRating.excellent?a=t.avQualityRatingString.excellent:b===t.avQualityRating.fair?a=t.avQualityRatingString.fair:b===t.avQualityRating.bad&&(a=t.avQualityRatingString.bad),a},z.prototype=Object.create(x.prototype),z.prototype.constructor=z,z.prototype.setEModelQuality=function(a){a<t.AudioEModelTresholds.green?this.quality.eModel=t.avQualityRating.excellent:a>t.AudioEModelTresholds.green&&a<t.AudioEModelTresholds.red?this.quality.eModel=t.avQualityRating.fair:a>t.AudioEModelTresholds.red&&(this.quality.eModel=t.avQualityRating.bad)},z.prototype.setThroughputQuality=function(a){null!==a&&void 0!==a&&(a>t.AudioThroughputThresholds.green?this.quality.bandwidth=t.avQualityRating.excellent:a>t.AudioThroughputThresholds.red&&a<t.AudioThroughputThresholds.green?this.quality.bandwidth=t.avQualityRating.fair:a<t.AudioThroughputThresholds.red&&(this.quality.bandwidth=t.avQualityRating.bad))},z.prototype.setup=function(a){x.prototype.setup.call(this,a),this.setThroughputQuality(a.data.csioIntBRKbps),this.setEModelQuality(a.data.csioeM),a.data.csioMediaType=g.MediaTypes.audio,a.data.csioMark=this.getQuality()},z.prototype.doSend=function(){return this.hasData()===!1,!1},z.prototype.getQuality=function(){var a=0,b=.5*this.quality.bandwidth+.5*this.quality.eModel;return b=Math.floor(b),b===t.avQualityRating.excellent?a=t.avQualityRatingString.excellent:b===t.avQualityRating.fair?a=t.avQualityRatingString.fair:b===t.avQualityRating.bad&&(a=t.avQualityRatingString.bad),a},A.prototype={constructor:A,getMonitor:function(a){var b;if(this.monitors[a.direction]&&(b=this.monitors[a.direction][a.ssrc]),void 0!==b)return this.monitors[a.direction][a.ssrc];var c=a.direction===g.Direction.inbound,d=a.direction===g.Direction.outbound,e=a.mediaType===g.MediaTypes.audio,f=a.mediaType===g.MediaTypes.video;return b=c&&e?new v:d&&e?new z:c&&f?new w:d&&f?new y:null,this.monitors[a.direction]||(this.monitors[a.direction]={}),this.monitors[a.direction][a.ssrc]=b,b},setupCodeBase:function(a){this.assembler.setupCodeBase(a)},isSendable:function(){var a=this.sendable;return this.sendable=!1,a},process:function(a){var b=this.assembler.do(a),c=this.getMonitor(b);return null===c||void 0===c?void console.warn("For ssrc "+b.ssrc+"we do not have monitor"):(c.doSend(b)&&(this.sendable=!0),c.add(b),void c.setup(a))},toString:function(){return"ToString function is not defined. for this object"},onDataSent:function(){for(var a in this.monitors)if(this.monitors.hasOwnProperty(a))for(var b in this.monitors[a])if(this.monitors[a].hasOwnProperty(b)){var c=this.monitors[a][b];null!==c?c.onDataSent():console.warn("A Monitor with ssrc: "+b+" should not be null but it is!")}}},B.prototype={constructor:B,receive:function(a){var b=(new Date).getTime(),c=a.streams,d=a.codeBase;this.monitors.setupCodeBase(d);for(var e=0;e<c.length;++e){var f=c[e];this.monitors.process(f)}var g=!1;if(C.adaptiveSending===!1)g=this.lastForwarded+C.SendingTimeTresholds.regular<b,g&&(this.output.send(c),this.lastForwarded=b);else{var h=3*Math.random()+1;g=this.lastForwarded+Math.min(C.SendingTimeTresholds.max,this.lastInterval*h)<b,(g||this.monitors.isSendable())&&(this.output.send(c),this.lastInterval=b-this.lastForwarded,this.lastForwarded=b)}}},C.prototype={constructor:C,fire:function(a){switch(this.currentState){case this.states.Idle:switch(a){case this.events.OnStart:this.currentState=this.states.Run;break;default:console.warn("Unhandled event "+a+" in "+this.currentState+" mode")}break;case this.states.Run:switch(a){case this.events.OnStop:this.currentState=this.states.Idle;break;case this.events.OnPolling:var b=arguments[1];this.analyzer.receive(b);break;case this.events.OnStatsRequest:var c=arguments[1];if(void 0===c){console.warn("OnStatsRequest event required a parameter to store the response");break}c.response=this.senderGate.requestStats();break;default:console.warn("Unhandled event "+a+" in "+this.currentState+" mode")}break;default:console.error("The Reporter machine is in an unkown state: "+this.currentState)}},toString:function(){return"Reporter is in "+this.currentState},setReportingMode:function(a){C.adaptiveSending=a===!0},setSubmissionInterval:function(a){C.SendingTimeTresholds.regular=a,C.SendingTimeTresholds.min=a,C.SendingTimeTresholds.max=a}},b.exports.Reporter=C},{"./slidingWindow":5,"./swAvg":7,"./swPercentileTracker":10,"./swPlugin":11}],7:[function(a,b,c){function d(a){e.call(this),this.avg=0,this.sum=0,this.count=0,this.filter=null,void 0===a?this.extractor=function(a){return a}:this.extractor=a}var e=a("./swPlugin");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.add=function(a){(null===this.filter||void 0===this.filter||this.filter(a))&&(this.sum+=parseInt(this.extractor(a)),++this.count,this.calc(this))},d.prototype.addFilter=function(a){this.filter=a},d.prototype.remove=function(a){(null===this.filter||void 0===this.filter||this.filter(a))&&(this.sum-=parseInt(this.extractor(a)),--this.count,this.calc(this))},d.prototype.calc=function(){this.count<1||(this.avg=this.sum/this.count,this.notify(this.avg))},d.prototype.getResult=function(){return this.avg},b.exports=d},{"./swPlugin":11}],8:[function(a,b,c){function d(a){this.value=a,this.created=(new Date).getTime()}d.prototype={constructor:d,getElapsed:function(){return(new Date).getTime()-this.created},toString:function(){return""}},b.exports=d},{}],9:[function(a,b,c){function d(){this.estimated=!1,this.tracked=0,this.max=this.min=this.actual=null}d.prototype={constructor:d,toString:function(){return"Tracked: "+this.tracked+" Estimated: "+this.estimated+" Min: "+this.min+" Max: "+this.max+" Actual: "+this.actual}},b.exports=d},{}],10:[function(a,b,c){function d(a,b,c){if(g.call(this),99<b||b<1)throw new RangeError("Percentile parameter must be between 1 and 99");this.comparator=a,this.percentile=b,this.meanCalcer="undefined"==typeof c?function(a,b){return(a+b)/2}:c,this.ratio=b/(100-b),this.maxtree=new f(a),this.mintree=new f(a),this.ratio<1?this.required=1/this.ratio+1:1<this.ratio?this.required=this.ratio+1:this.required=2,this.maxcounter=this.mincounter=0,this.result=null,this.filter=null}var e=a("./swPercentileNotification"),f=a("./binaryTree"),g=a("./swPlugin");d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.addFilter=function(a,b){this.filter={callback:a,that:b}},d.prototype.doFilter=function(a){return null===this.filter||(void 0===this.filter.that||null===this.filter.that?this.filter.callback(a):this.filter.callback.call(this.filter.that,a))},d.prototype.getResult=function(){return this.result},d.prototype.add=function(a){if(this.doFilter(a)){if(this.maxcounter<1)return this.maxtree.insert(a),void++this.maxcounter;this.comparator(a,this.maxtree.getTopValue())<=0?(this.maxtree.insert(a),++this.maxcounter):(this.mintree.insert(a),++this.mincounter),this.balancing(),this.calculate()}},d.prototype.remove=function(a){if(this.doFilter(a)){if(this.maxtree.delete(a))--this.maxcounter;else{if(!this.mintree.delete(a))throw new ReferenceError("The requested value "+a+" is not found in trees");--this.mincounter}this.balancing(),this.calculate()}},d.prototype.balancing=function(){var a=function(){for(var a=(this.maxcounter+1)/(this.mincounter-1);;a=(this.maxcounter+1)/(this.mincounter-1)){if(this.ratio<a||this.mincounter<1)return;this.maxtree.insertByTop(this.mintree.deleteBottomValue()),++this.maxcounter,--this.mincounter}},b=function(){for(var a=(this.maxcounter-1)/(this.mincounter+1);;a=(this.maxcounter-1)/(this.mincounter+1)){if(a<this.ratio||this.maxcounter<1)return;this.mintree.insertByBottom(this.maxtree.deleteTopValue()),++this.mincounter,--this.maxcounter}};if(!(this.maxcounter+this.mincounter<this.required)){if(this.mincounter<1)return void b.call(this);if(this.maxcounter<1)return void a.call(this);var c=this.maxcounter/this.mincounter;this.ratio<c?b.call(this):a.call(this)}},d.prototype.calculate=function(){var a,b,c=new e,d=null,f=this.mincounter+this.maxcounter;if(!(f<1)){if(this.mincounter<1?(b=this.maxtree.getTopValue(),a=this.maxtree.getBottomValue()):this.maxcounter<1?(b=this.mintree.getTopValue(),a=this.mintree.getBottomValue()):(b=this.mintree.getTopValue(),a=this.maxtree.getBottomValue()),c.min=a,c.max=b,c.tracked=f,f<this.required||this.mincounter<1)return d=this.ratio<1?a:1<this.ratio?b:this.meanCalcer(a,b),c.actual=d,c.estimated=!0,this.result=c,void this.notify(this.result);var g=this.maxcounter/this.mincounter;d=this.ratio<g?this.maxtree.getTopValue():g<this.ratio?this.mintree.getBottomValue():this.meanCalcer(this.mintree.getBottomValue(),this.maxtree.getTopValue()),c.actual=d,this.result=c,this.notify(this.result)}},d.prototype.map=function(a){this.mapping(this.result.actual,a)},b.exports=d},{"./binaryTree":1,"./swPercentileNotification":9,"./swPlugin":11}],11:[function(a,b,c){function d(){this.attaches=[],this.signalListeners=[],this.mapFnc=null}d.prototype={constructor:d,add:function(a){console.log("Abstract method is called width value: "+a)},remove:function(a){console.log("Abstract method is called with value: "+a)},attach:function(a,b){this.attaches.push({cb:a,that:"undefined"==typeof b?null:b})},notify:function(a){for(var b=0;b<this.attaches.length;++b){var c=this.attaches[b];c.cb?c.cb.call(c.that,a):c.cb(a)}},addMapFnc:function(a){this.mapFnc=a},map:function(){},mapping:function(a,b){null!==this.mapFnc&&this.mapFnc(a,b)},addSignalListener:function(a,b,c){this.signalListeners.push({signalName:a,cb:b,that:"undefined"==typeof c?null:c})},signalize:function(a,b){for(var c=0;c<this.signalListeners.length;++c){var d=this.signalListeners[c];d.signalName===a&&null!==d.cb&&void 0!==d.cb&&(d.that?d.cb.call(d.that,b):d.cb(b))}}},b.exports=d},{}]},{},[2]);
